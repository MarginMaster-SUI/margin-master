# MarginMaster - AGI é–‹ç™¼å”ä½œæŒ‡å—

> **ç‰ˆæœ¬:** 2.0
> **æ—¥æœŸ:** 2026-02-02
> **ç‹€æ…‹:** Ready for Implementation
> **é©ç”¨ç¯„åœ:** Cursor AI, Claude, GPT-4 ç­‰ AI ç·¨ç¨‹åŠ©æ‰‹

---

## ğŸ“‹ ç›®éŒ„

1. [AGI å”ä½œç­–ç•¥](#agi-å”ä½œç­–ç•¥)
2. [é …ç›®åˆå§‹åŒ– Prompts](#é …ç›®åˆå§‹åŒ–-prompts)
3. [åŠŸèƒ½æ¨¡çµ„ Prompts](#åŠŸèƒ½æ¨¡çµ„-prompts)
4. [æ¸¬è©¦ç›¸é—œ Prompts](#æ¸¬è©¦ç›¸é—œ-prompts)
5. [æ•´åˆèˆ‡éƒ¨ç½² Prompts](#æ•´åˆèˆ‡éƒ¨ç½²-prompts)
6. [å®‰å…¨æ€§å¯©æŸ¥](#å®‰å…¨æ€§å¯©æŸ¥)
7. [å¸¸è¦‹éŒ¯èª¤èˆ‡ä¿®æ­£](#å¸¸è¦‹éŒ¯èª¤èˆ‡ä¿®æ­£)
8. [æœ€ä½³å¯¦è¸](#æœ€ä½³å¯¦è¸)

---

## AGI å”ä½œç­–ç•¥

### é–‹ç™¼æµç¨‹

```
éœ€æ±‚æ‹†è§£ â†’ ç”Ÿæˆä»£ç¢¼ â†’ å¯©æŸ¥ä¿®æ­£ â†’ æ•´åˆæ¸¬è©¦ â†’ è¿­ä»£å„ªåŒ–
    â†“         â†“         â†“         â†“         â†“
  1-2å¤©     3-4å¤©     æŒçºŒé€²è¡Œ    Day 6     Day 7
```

### æ ¸å¿ƒåŸå‰‡

#### 1. æ˜ç¢ºçš„ä¸Šä¸‹æ–‡

**æ¯æ¬¡èˆ‡ AGI å°è©±éƒ½æ‡‰åŒ…å«ï¼š**

```markdown
# Project Context
- Project: MarginMaster
- Goal: [å…·é«”ç›®æ¨™ï¼Œå¦‚ï¼šå¯¦ç¾ä¿è­‰é‡‘äº¤æ˜“ç•Œé¢]
- Tech Stack: React 18 + TypeScript, Sui Move, Node.js, PostgreSQL

# Current State
- Completed: [å·²å®Œæˆæ¨¡çµ„åˆ—è¡¨]
- Current Files: [ç›¸é—œæ–‡ä»¶çµæ§‹]

# Task
[å…·é«”è¦æ±‚]

# Constraints
- ä½¿ç”¨ TypeScriptï¼ˆä¸ä½¿ç”¨ anyï¼‰
- æ‰€æœ‰é‡‘é¡ä½¿ç”¨ BigNumber è™•ç†
- åŒ…å«éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæª¢æŸ¥
```

#### 2. å¢é‡é–‹ç™¼

**åŸå‰‡**ï¼šä¸€æ¬¡è™•ç†ä¸€å€‹æ¨¡çµ„ï¼Œé¿å…å–®æ¬¡è¦æ±‚éå¤§

```
âœ… å¥½çš„åšæ³•ï¼š
"è«‹å¯¦ç¾ TradingPanel çµ„ä»¶ï¼ŒåŒ…å«è¨‚å–®è¡¨å–®å’Œé¢¨éšªæŒ‡æ¨™é¡¯ç¤º"

âŒ å£çš„åšæ³•ï¼š
"è«‹å¯¦ç¾æ•´å€‹äº¤æ˜“ç³»çµ±ï¼ŒåŒ…æ‹¬å‰ç«¯ã€å¾Œç«¯ã€æ™ºèƒ½åˆç´„ã€æ¸¬è©¦ã€æ–‡æª”"
```

#### 3. æ¸¬è©¦é©…å‹•

**æ¯æ¬¡ç”Ÿæˆä»£ç¢¼æ™‚éƒ½è¦æ±‚åŒæ­¥ç”Ÿæˆæ¸¬è©¦ï¼š**

```markdown
è«‹åœ¨ç”ŸæˆåŠŸèƒ½ä»£ç¢¼çš„åŒæ™‚ï¼Œç”Ÿæˆå°æ‡‰çš„å–®å…ƒæ¸¬è©¦ï¼Œæ¸¬è©¦éœ€è¦†è“‹ï¼š
1. æ­£å¸¸æƒ…æ³ï¼ˆhappy pathï¼‰
2. é‚Šç•Œæ¢ä»¶ï¼ˆedge casesï¼‰
3. éŒ¯èª¤è™•ç†ï¼ˆerror handlingï¼‰
4. å¤–éƒ¨ä¾è³´ä½¿ç”¨ mock è™•ç†
```

#### 4. ä»£ç¢¼å¯©æŸ¥

**äººé¡å¿…é ˆå¯©æŸ¥çš„é—œéµé‚è¼¯ï¼š**

```markdown
âš ï¸ å¿…é ˆäººå·¥å¯©æŸ¥ï¼š

1. æ™ºèƒ½åˆç´„ï¼š
   - æ¬Šé™æª¢æŸ¥ï¼ˆsender/ownerï¼‰
   - è³‡é‡‘è½‰ç§»ï¼ˆtransferã€coin::splitï¼‰
   - é¢¨éšªè¨ˆç®—é‚è¼¯
   - è²»ç”¨è¨ˆç®—èˆ‡åˆ†é…
   - ä»»ä½•æ¶‰åŠ Loop + å¤§é‡æ“ä½œçš„åœ°æ–¹ï¼ˆGas é¢¨éšªï¼‰

2. å‰ç«¯ï¼š
   - ä¸‹å–®èˆ‡ç°½åé‚è¼¯
   - é¢¨éšªæç¤ºèˆ‡é™åˆ¶
   - ç”¨æˆ¶è¼¸å…¥é©—è­‰

3. å¾Œç«¯ï¼š
   - SQL æŸ¥è©¢ï¼ˆé˜²æ³¨å…¥ï¼‰
   - å¤–éƒ¨è¼¸å…¥è™•ç†
   - æ¬Šé™é©—è­‰
```

#### 5. æ–‡æª”åŒæ­¥

**è¦æ±‚ AGI ç‚ºé—œéµä»£ç¢¼æ·»åŠ è¨»é‡‹ï¼š**

```typescript
/**
 * è¨ˆç®—è·Ÿå–®è¦æ¨¡
 * @param originalQty - Leader çš„åŸå§‹è¨‚å–®æ•¸é‡
 * @param copyRatio - è·Ÿå–®æ¯”ä¾‹ï¼ˆbasis pointsï¼Œ5000 = 50%ï¼‰
 * @param maxPosition - æœ€å¤§å–®ç­†å€‰ä½é™åˆ¶
 * @returns å¯¦éš›è·Ÿå–®æ•¸é‡ï¼ˆå·²æ‡‰ç”¨æœ€å¤§å€‰ä½é™åˆ¶ï¼‰
 */
public fun calculate_copy_size(
    originalQty: bigint,
    copyRatio: number,
    maxPosition: bigint
): bigint {
    const calculated = (originalQty * BigInt(copyRatio)) / 10000n;
    return calculated > maxPosition ? maxPosition : calculated;
}
```

---

## é …ç›®åˆå§‹åŒ– Prompts

### Prompt 1ï¼šé …ç›®è…³æ‰‹æ¶

```markdown
# Context
æˆ‘æ­£åœ¨é–‹ç™¼ MarginMasterï¼Œä¸€å€‹åŸºæ–¼ Sui å€å¡Šéˆå’Œ DeepBook Margin çš„ç¤¾äº¤åŒ–ä¿è­‰é‡‘äº¤æ˜“å¹³å°ã€‚

# Tech Stack
- Frontend: React 18 + TypeScript + Vite
- Wallet: @mysten/dapp-kit
- State: Zustand + React Query
- Smart Contract: Sui Move
- Backend: Node.js + Express + Prisma
- Database: PostgreSQL
- Cache: Redis
- Blockchain: Sui Testnet

# Task
è«‹å¹«æˆ‘ç”Ÿæˆå®Œæ•´çš„é …ç›®åˆå§‹åŒ–çµæ§‹ï¼š

## 1. å‰ç«¯é …ç›®ï¼ˆmarginmaster-frontendï¼‰

ä½¿ç”¨ Vite å‰µå»º React + TypeScript é …ç›®ï¼š
```bash
npm create vite@latest marginmaster-frontend -- --template react-ts
cd marginmaster-frontend
```

å®‰è£ä¾è³´ä¸¦é…ç½®ï¼š
- @mysten/sui.js @mysten/dapp-kit
- zustand @tanstack/react-query
- react-router-dom react-hook-form zod
- recharts bignumber.js date-fns
- tailwindcss

å‰µå»ºæ–‡ä»¶å¤¾çµæ§‹ï¼š
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ trading/
â”‚   â”œâ”€â”€ copyTrade/
â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”œâ”€â”€ risk/
â”‚   â””â”€â”€ common/
â”œâ”€â”€ pages/
â”œâ”€â”€ hooks/
â”œâ”€â”€ services/
â”œâ”€â”€ store/
â”œâ”€â”€ types/
â””â”€â”€ utils/
```

## 2. Sui Move é …ç›®ï¼ˆmargin_masterï¼‰

å‰µå»ºæ™ºèƒ½åˆç´„é …ç›®ï¼š
```bash
sui move new margin_master
```

å‰µå»ºæ¨¡çµ„çµæ§‹ï¼š
```
sources/
â”œâ”€â”€ copy_trade.move
â”œâ”€â”€ trader_profile.move
â”œâ”€â”€ fee_manager.move
â”œâ”€â”€ risk_checker.move
â””â”€â”€ emergency_pause.move
```

é…ç½® Move.tomlï¼š
- æ·»åŠ  Sui Framework ä¾è³´
- æ·»åŠ  DeepBook ä¾è³´

## 3. å¾Œç«¯é …ç›®ï¼ˆmarginmaster-backendï¼‰

å‰µå»º Node.js é …ç›®ä¸¦å®‰è£ï¼š
- express cors helmet compression
- @mysten/sui.js
- @prisma/client prisma
- bullmq ioredis
- pino
- typescript tsx

å‰µå»ºæ–‡ä»¶å¤¾çµæ§‹ï¼š
```
src/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ services/
â”œâ”€â”€ workers/
â”œâ”€â”€ indexers/
â”œâ”€â”€ lib/
â””â”€â”€ types/
```

## 4. ç’°å¢ƒé…ç½®

å‰µå»º .env.example æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- SUI_NETWORK=testnet
- SUI_RPC_URL=https://fullnode.testnet.sui.io:443
- DATABASE_URL=postgresql://...
- REDIS_URL=redis://...

è«‹æä¾›å®Œæ•´çš„é…ç½®æ–‡ä»¶å…§å®¹å’Œå®‰è£å‘½ä»¤ï¼Œä¸åªæ˜¯ç‰‡æ®µã€‚
```

---

### Prompt 2ï¼šéŒ¢åŒ…é€£æ¥è¨­ç½®

```markdown
# Context
MarginMaster éœ€è¦æ•´åˆ Sui éŒ¢åŒ…é€£æ¥åŠŸèƒ½ï¼Œä½¿ç”¨ @mysten/dapp-kitã€‚

# Requirements
1. æ”¯æŒä¸»æµ Sui éŒ¢åŒ…ï¼ˆSui Wallet, Suiet, Ethosï¼‰
2. é€£æ¥å¾Œé¡¯ç¤ºç”¨æˆ¶åœ°å€å’Œ SUI é¤˜é¡
3. æ–·é–‹é€£æ¥åŠŸèƒ½
4. ç¶²çµ¡åˆ‡æ›ï¼ˆTestnet/Mainnetï¼‰
5. ç°¡æ½”çš„ UIï¼Œæ”¯æŒè‡ªå®šç¾©æ¨£å¼

# Task
è«‹ç”Ÿæˆä»¥ä¸‹ä»£ç¢¼ï¼š

## 1. src/App.tsx
è¨­ç½® SuiClientProvider å’Œ WalletProviderï¼š
- é…ç½® Testnet RPC
- æ”¯æŒå¤šå€‹ç¶²çµ¡ï¼ˆdevnet/testnet/mainnetï¼‰
- æ•´åˆ React Query

## 2. src/components/wallet/ConnectButton.tsx
éŒ¢åŒ…é€£æ¥æŒ‰éˆ•çµ„ä»¶ï¼š
- æœªé€£æ¥æ™‚é¡¯ç¤ºã€Œé€£æ¥éŒ¢åŒ…ã€æŒ‰éˆ•
- å·²é€£æ¥æ™‚é¡¯ç¤ºæˆªæ–·åœ°å€ï¼ˆ0x1234...5678ï¼‰
- é»æ“Šåœ°å€é¡¯ç¤ºä¸‹æ‹‰èœå–®ï¼ˆæŸ¥çœ‹é¤˜é¡ã€æ–·é–‹é€£æ¥ï¼‰
- é¡¯ç¤º SUI é¤˜é¡

## 3. src/hooks/useWallet.ts
å°è£å¸¸ç”¨éŒ¢åŒ…æ“ä½œï¼š
- address: string | undefined
- isConnected: boolean
- executeTransaction: (tx: TransactionBlock) => Promise<SuiTransactionBlockResponse>
- åŒ…å«éŒ¯èª¤è™•ç†

## 4. src/types/wallet.ts
éŒ¢åŒ…ç›¸é—œ TypeScript é¡å‹å®šç¾©

è¦æ±‚ï¼š
- ä½¿ç”¨ TypeScriptï¼ˆä¸ä½¿ç”¨ anyï¼‰
- åŒ…å«åŸºæœ¬éŒ¯èª¤è™•ç†èˆ‡ loading ç‹€æ…‹
- æ·»åŠ å¿…è¦çš„ JSDoc è¨»é‡‹
```

---

## åŠŸèƒ½æ¨¡çµ„ Prompts

### Prompt 3ï¼šä¿è­‰é‡‘äº¤æ˜“ç•Œé¢

```markdown
# Context
æ§‹å»º MarginMaster çš„æ ¸å¿ƒäº¤æ˜“ç•Œé¢ï¼Œè®“ç”¨æˆ¶åœ¨ DeepBook Margin ä¸Šé€²è¡Œä¿è­‰é‡‘äº¤æ˜“ã€‚

# Technical Details
- ä½¿ç”¨ DeepBook Margin MarginManager å’Œ Pool Proxy
- æ”¯æŒå¸‚åƒ¹å–®èˆ‡é™åƒ¹å–®
- æ”¯æŒåšå¤š/åšç©º
- æ§“æ¡¿å€æ•¸é¸æ“‡ï¼ˆ1x-10xï¼‰
- å¯¦æ™‚é¡¯ç¤ºé¢¨éšªæŒ‡æ¨™

# Task
è«‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

## 1. src/components/trading/TradingPanel/index.tsx
ä¸»äº¤æ˜“é¢æ¿çµ„ä»¶ï¼š
- Props: poolId, marginManagerId
- åŒ…å« OrderForm å’Œ RiskMetrics å­çµ„ä»¶
- ä½¿ç”¨ Card å¸ƒå±€

## 2. src/components/trading/TradingPanel/OrderForm.tsx
è¨‚å–®è¡¨å–®çµ„ä»¶ï¼š
- ä½¿ç”¨ react-hook-form + zod é©—è­‰
- UI å…ƒç´ ï¼š
  - è¨‚å–®é¡å‹åˆ‡æ›ï¼ˆå¸‚åƒ¹/é™åƒ¹ï¼‰
  - è²·/è³£æŒ‰éˆ•ï¼ˆç¶ è‰²åšå¤š/ç´…è‰²åšç©ºï¼‰
  - åƒ¹æ ¼è¼¸å…¥ï¼ˆé™åƒ¹å–®ï¼‰
  - æ•¸é‡è¼¸å…¥
  - æ§“æ¡¿æ»‘æ¡¿ï¼ˆ1x-10xï¼‰
  - æ­¢æ/æ­¢ç›ˆï¼ˆå¯é¸ï¼‰
  - æäº¤æŒ‰éˆ•
- é¡¯ç¤ºé ä¼°æ•¸æ“šï¼š
  - é–‹å€‰åƒ¹å€¼
  - æ‰€éœ€ä¿è­‰é‡‘
  - é ä¼°æ¸…ç®—åƒ¹æ ¼

## 3. src/components/trading/TradingPanel/RiskMetrics.tsx
é¢¨éšªæŒ‡æ¨™é¡¯ç¤ºçµ„ä»¶ï¼š
- å¥åº·åº¦è©•åˆ†ï¼ˆ0-100ï¼Œå¸¶é¡è‰²ï¼‰
- é¢¨éšªæ¯”ç‡
- æ¸…ç®—åƒ¹æ ¼ï¼ˆç´…è‰²é«˜äº®ï¼‰
- å·²ç”¨/å¯ç”¨ä¿è­‰é‡‘
- é¢¨éšªè­¦å ±ï¼ˆå¥åº·åº¦ < 30 æ™‚é¡¯ç¤ºï¼‰

## 4. src/services/deepbook.ts
DeepBook äº¤æ˜“æœå‹™ï¼š
```typescript
export async function placeMarketOrder(params: {
  marginManagerId: string;
  poolId: string;
  quantity: number;
  isBuy: boolean;
  leverage: number;
}): Promise<SuiTransactionBlockResponse>;

export async function placeLimitOrder(params: {
  marginManagerId: string;
  poolId: string;
  price: number;
  quantity: number;
  isBuy: boolean;
  leverage: number;
}): Promise<SuiTransactionBlockResponse>;

export async function getRiskMetrics(
  marginManagerId: string
): Promise<RiskMetrics>;
```

## 5. src/hooks/useTradingPanel.ts
äº¤æ˜“é¢æ¿é‚è¼¯ Hookï¼š
- ç®¡ç†è¡¨å–®ç‹€æ…‹
- ä¸‹å–®å‰é¢¨éšªæª¢æŸ¥
- è‹¥é¢¨éšªéé«˜å‰‡ç¦æ­¢ä¸‹å–®ä¸¦é¡¯ç¤ºè­¦å‘Š

è¦æ±‚ï¼š
- å®Œæ•´ TypeScript é¡å‹
- æ¯å€‹å…¬é–‹å‡½æ•¸æ·»åŠ  JSDoc
- ç’°å¢ƒè®Šæ•¸è®€å– PACKAGE_IDï¼ˆä¸ç¡¬ç·¨ç¢¼ï¼‰
- åŒ…å«éŒ¯èª¤è™•ç†å’Œ loading ç‹€æ…‹
```

---

### Prompt 4ï¼šè·Ÿå–®æ™ºèƒ½åˆç´„

```markdown
# Context
ç”¨ Sui Move ç·¨å¯«è·Ÿå–®æ™ºèƒ½åˆç´„ï¼Œå…è¨± Follower è‡ªå‹•è·Ÿéš¨ Leader çš„äº¤æ˜“ã€‚

# Technical Requirements
- æ•´åˆ DeepBook Margin çš„ MarginManager
- è‡ªå®šç¾©è·Ÿå–®æ¯”ä¾‹ï¼ˆ1%-100%ï¼‰
- è²»ç”¨åˆ†é…æ©Ÿåˆ¶ï¼ˆProtocol 5%ï¼ŒLeader 95%ï¼‰
- é¢¨éšªæª¢æŸ¥ï¼ˆFollower é¢¨éšªæ¯”ç‡ > 1.2 æ‰å…è¨±è·Ÿå–®ï¼‰
- æ”¯æŒæœ€å¤§å€‰ä½é™åˆ¶

# Data Structures

## CopyTradeRelation
```move
struct CopyTradeRelation has key, store {
    id: UID,
    leader: address,
    follower: address,
    copy_ratio: u64,           // basis points (5000 = 50%)
    max_position_size: u64,
    fee_rate: u64,             // basis points
    is_active: bool,
    total_copied_trades: u64,
    total_fees_paid: u64,
}
```

## TraderProfile
```move
struct TraderProfile has key {
    id: UID,
    trader: address,
    total_followers: u64,
    total_pnl: i64,
    total_trades: u64,
    win_rate: u64,             // basis points
}
```

# Task
è«‹ç”Ÿæˆä»¥ä¸‹ Move æ¨¡çµ„ï¼š

## 1. sources/copy_trade.move

å®Œæ•´å¯¦ç¾ä»¥ä¸‹å‡½æ•¸ï¼š

```move
module margin_master::copy_trade {
    use sui::tx_context::TxContext;
    use sui::object::{Self, UID};
    use sui::event;

    // éŒ¯èª¤ç¢¼
    const E_UNAUTHORIZED: u64 = 1;
    const E_INVALID_COPY_RATIO: u64 = 2;
    const E_RISK_TOO_HIGH: u64 = 3;

    // å¸¸æ•¸
    const MIN_RISK_RATIO_BPS: u64 = 12000;  // 1.2x
    const BPS_DENOMINATOR: u64 = 10000;

    /// å‰µå»ºè·Ÿå–®é—œä¿‚
    public entry fun create_copy_relation(
        leader: address,
        copy_ratio: u64,
        max_position_size: u64,
        fee_rate: u64,
        ctx: &mut TxContext
    ) {
        // å¯¦ç¾é‚è¼¯
    }

    /// åœæ­¢è·Ÿå–®é—œä¿‚
    public entry fun stop_copy_relation(
        relation: CopyTradeRelation,
        ctx: &mut TxContext
    ) {
        // å¯¦ç¾é‚è¼¯
    }

    /// è¨ˆç®—è·Ÿå–®è¦æ¨¡
    public fun calculate_copy_size(
        leader_quantity: u64,
        copy_ratio: u64,
        max_position_size: u64
    ): u64 {
        // å¯¦ç¾é‚è¼¯
    }

    /// æª¢æŸ¥é¢¨éšªæ˜¯å¦å¯æ¥å—
    public fun is_risk_acceptable(
        risk_ratio_bps: u64
    ): bool {
        risk_ratio_bps >= MIN_RISK_RATIO_BPS
    }

    /// ç™¼å‡ºäº¤æ˜“ä¿¡è™Ÿäº‹ä»¶
    public entry fun emit_leader_trade_signal(
        pool_id: ID,
        side: bool,
        quantity: u64,
        ctx: &mut TxContext
    ) {
        // å¯¦ç¾é‚è¼¯
    }
}
```

## 2. sources/fee_manager.move

è²»ç”¨è¨ˆç®—èˆ‡åˆ†é…ï¼š
```move
/// è¨ˆç®—è²»ç”¨åˆ†é…
/// è¿”å›ï¼š(protocol_fee, leader_fee)
public fun calculate_fee_split(
    total_fee: u64,
    protocol_fee_rate: u64
): (u64, u64);
```

è¦æ±‚ï¼š
- ä½¿ç”¨æ¸…æ¥šçš„éŒ¯èª¤ç¢¼ï¼ˆconst E_XXXï¼‰
- æ¯å€‹ entry fun æª¢æŸ¥ sender æ¬Šé™
- ç‚ºæ ¸å¿ƒå‡½æ•¸æ·»åŠ è¨»é‡‹
- åŒ…å«äº‹ä»¶å®šç¾©ï¼ˆLeaderTradeSignal, CopyTradeExecutedï¼‰
```

---

### Prompt 5ï¼šæ’è¡Œæ¦œç³»çµ±

```markdown
# Context
MarginMaster éœ€è¦æ’è¡Œæ¦œç³»çµ±ï¼Œå±•ç¤ºè¡¨ç¾æœ€ä½³çš„äº¤æ˜“è€…ä¸¦è¨ˆç®—ç¸¾æ•ˆæŒ‡æ¨™ã€‚

# Architecture
- Frontend: é¡¯ç¤ºæ’è¡Œæ¦œèˆ‡äº¤æ˜“è€…è©³ç´°é 
- Backend: Node.js APIï¼ˆç´¢å¼•éˆä¸Šäº‹ä»¶ä¸¦è¨ˆç®—çµ±è¨ˆï¼‰
- Database: PostgreSQL

# Metrics
1. 30 å¤©ç›ˆè™§ï¼ˆPnLï¼‰
2. å‹ç‡ï¼ˆwinning trades / total tradesï¼‰
3. å¹³å‡ç›ˆåˆ© / å¹³å‡è™§æ
4. æœ€å¤§å›æ’¤ï¼ˆmax drawdownï¼‰
5. å¤æ™®æ¯”ç‡ï¼ˆSharpe ratioï¼‰
6. è·Ÿéš¨è€…æ•¸é‡
7. ç¸½äº¤æ˜“æ¬¡æ•¸

# Task - Backend

## 1. backend/src/indexers/SuiEventListener.ts
ç›£è½ Sui éˆä¸Šäº‹ä»¶ï¼š
```typescript
export class SuiEventListener {
  private suiClient: SuiClient;

  async startListening(): Promise<void> {
    // ç›£è½ LeaderTradeSignal äº‹ä»¶
    // ç›£è½ CopyTradeExecuted äº‹ä»¶
  }

  private async handleTradeEvent(event: SuiEvent): Promise<void> {
    // è§£æäº‹ä»¶ä¸¦å­˜å…¥ trades è¡¨
  }
}
```

## 2. backend/src/services/leaderboard/PerformanceCalculator.ts
ç¸¾æ•ˆè¨ˆç®—æœå‹™ï¼š
```typescript
export class PerformanceCalculator {
  async calculateTraderStats(userAddress: string): Promise<TraderStats>;

  private calculateMaxDrawdown(trades: Trade[]): number;
  private calculateSharpeRatio(trades: Trade[]): number;
  private calculateWinRate(trades: Trade[]): number;
}
```

## 3. backend/src/api/routes/leaderboard.ts
API ç«¯é»ï¼š
- GET /api/leaderboard?sortBy=totalPnl&order=desc&page=1&limit=50
- GET /api/traders/:address/stats
- GET /api/traders/:address/trades

# Task - Frontend

## 4. src/components/leaderboard/LeaderboardTable/index.tsx
æ’è¡Œæ¦œè¡¨æ ¼çµ„ä»¶ï¼š
- é¡¯ç¤ºå‰ N åäº¤æ˜“è€…
- æ¬„ä½ï¼šæ’åã€äº¤æ˜“è€…ã€30å¤©ç›ˆè™§ã€å‹ç‡ã€äº¤æ˜“æ¬¡æ•¸ã€è·Ÿéš¨è€…æ•¸
- æ”¯æŒåˆ†é 
- æ’åºåŠŸèƒ½ï¼ˆæŒ‰ä¸åŒæŒ‡æ¨™æ’åºï¼‰

## 5. src/pages/Profile/index.tsx
äº¤æ˜“è€…è©³ç´°é ï¼š
- é¡¯ç¤ºäº¤æ˜“è€…çµ±è¨ˆæ•¸æ“š
- ç›ˆè™§æŠ˜ç·šåœ–ï¼ˆä½¿ç”¨ Rechartsï¼‰
- æœ€è¿‘äº¤æ˜“åˆ—è¡¨
- è·Ÿéš¨è€…åˆ—è¡¨
- è·Ÿå–®æŒ‰éˆ•

è¦æ±‚ï¼š
- æ‰€æœ‰ API è¿”å›é¡å‹æ˜ç¢ºå®šç¾©
- æ’è¡Œæ¦œæ”¯æŒåˆ†é èˆ‡æ’åº
- åŒ…å«éŒ¯èª¤è™•ç†
- ä½¿ç”¨ React Query ç®¡ç†æœå‹™ç«¯ç‹€æ…‹
```

---

### Prompt 6ï¼šé¢¨éšªç®¡ç†å¼•æ“

```markdown
# Context
MarginMaster éœ€è¦å¯¦æ™‚é¢¨éšªç®¡ç†å¼•æ“ï¼Œè¨ˆç®—é¢¨éšªæŒ‡æ¨™ä¸¦æä¾›è­¦å‘Šã€‚

# Risk Metrics
1. é¢¨éšªæ¯”ç‡ = ç¸½è³‡ç”¢ / ç¸½è² å‚µ
2. æ¸…ç®—åƒ¹æ ¼ = ä½¿è³‡ç”¢/è² å‚µ = 1.1 çš„åƒ¹æ ¼
3. å¥åº·åº¦ï¼ˆ0-100ï¼‰ï¼š
   - â‰¥ 2.0 â†’ 100
   - 1.5 â†’ 80
   - 1.3 â†’ 60
   - 1.15 â†’ 30
   - < 1.15 â†’ 10
4. ä¿è­‰é‡‘ä½¿ç”¨ç‡ = å·²ç”¨ä¿è­‰é‡‘ / ç¸½ä¿è­‰é‡‘

# Task

## 1. src/services/riskEngine.ts

å®Œæ•´å¯¦ç¾ï¼š
```typescript
export interface RiskMetrics {
  currentRiskRatio: number;
  liquidationPrice: number;
  marginUsed: number;
  marginAvailable: number;
  positionSize: number;
  unrealizedPnL: number;
  healthScore: number;
}

export interface RiskAlert {
  level: 'info' | 'warning' | 'danger';
  message: string;
  action: string;
}

/**
 * è¨ˆç®—é¢¨éšªæŒ‡æ¨™
 * @param marginManagerId - Margin Manager å°è±¡ ID
 * @returns å®Œæ•´çš„é¢¨éšªæŒ‡æ¨™
 */
export async function calculateRiskMetrics(
  marginManagerId: string
): Promise<RiskMetrics>;

/**
 * ç”Ÿæˆé¢¨éšªè­¦å ±
 * @param metrics - ç•¶å‰é¢¨éšªæŒ‡æ¨™
 * @param currentPrice - ç•¶å‰å¸‚å ´åƒ¹æ ¼
 * @returns è­¦å ±åˆ—è¡¨
 */
export function generateRiskAlerts(
  metrics: RiskMetrics,
  currentPrice: number
): RiskAlert[];

/**
 * è¨ˆç®—æ¸…ç®—åƒ¹æ ¼
 */
export function calculateLiquidationPrice(
  baseBalance: number,
  quoteBalance: number,
  borrowedBase: number,
  borrowedQuote: number
): number;

/**
 * å»ºè­°æ­¢æåƒ¹æ ¼
 */
export function suggestStopLoss(
  entryPrice: number,
  currentPrice: number,
  positionType: 'long' | 'short',
  riskTolerance: number
): number;
```

## 2. src/components/risk/RiskDashboard.tsx
é¢¨éšªå„€è¡¨æ¿çµ„ä»¶ï¼š
- æ¥æ”¶ RiskMetrics å’Œ RiskAlert[]
- é¡¯ç¤ºå¥åº·åº¦è©•åˆ†ï¼ˆå¸¶é¡è‰²ï¼‰
- é¡¯ç¤ºæ‰€æœ‰é¢¨éšªæŒ‡æ¨™
- é¡¯ç¤ºè­¦å ±åˆ—è¡¨

## 3. src/hooks/useRiskMonitor.ts
é¢¨éšªç›£æ§ Hookï¼š
- ä½¿ç”¨ React Query
- æ¯ 30 ç§’æ‹‰å–ä¸€æ¬¡é¢¨éšªæŒ‡æ¨™
- å¥åº·åº¦ < 30 æ™‚è§¸ç™¼ç€è¦½å™¨é€šçŸ¥

è¦æ±‚ï¼š
- ä½¿ç”¨ BigNumber æˆ– Decimal.js è™•ç†é‡‘é¡
- æ·»åŠ å–®å…ƒæ¸¬è©¦ç¤ºä¾‹
- å®Œæ•´çš„ TypeScript é¡å‹
```

---

## æ¸¬è©¦ç›¸é—œ Prompts

### Prompt 7ï¼šæ™ºèƒ½åˆç´„æ¸¬è©¦

```markdown
# Context
ç‚º MarginMaster çš„ Sui Move æ™ºèƒ½åˆç´„ç·¨å¯«æ¸¬è©¦ï¼Œç¢ºä¿è·Ÿå–®é‚è¼¯æ­£ç¢ºã€‚

# Test Requirements
- è·Ÿå–®æ¯”ä¾‹è¨ˆç®—
- æœ€å¤§å€‰ä½é™åˆ¶
- é¢¨éšªæª¢æŸ¥æ‹’çµ•
- æ¬Šé™æª¢æŸ¥

# Task
è«‹ç‚º sources/copy_trade.move ç”Ÿæˆå®Œæ•´æ¸¬è©¦ï¼š

## tests/copy_trade_tests.move

```move
#[test_only]
module margin_master::copy_trade_tests {
    use margin_master::copy_trade;
    use sui::test_scenario;

    #[test]
    fun test_create_copy_relation() {
        // æ¸¬è©¦å‰µå»ºè·Ÿå–®é—œä¿‚
        // é©—è­‰æ‰€æœ‰å­—æ®µæ­£ç¢ºè¨­ç½®
    }

    #[test]
    fun test_copy_size_calculation() {
        // leader_order_size = 1000
        // copy_ratio = 5000 (50%)
        // max_position_size = 300
        // æœŸæœ›çµæœ: 300ï¼ˆè¢« max_position_size é™åˆ¶ï¼‰
    }

    #[test]
    fun test_copy_size_within_limit() {
        // leader_order_size = 1000
        // copy_ratio = 2000 (20%)
        // max_position_size = 500
        // æœŸæœ›çµæœ: 200ï¼ˆæœªè§¸åŠé™åˆ¶ï¼‰
    }

    #[test]
    #[expected_failure(abort_code = copy_trade::E_UNAUTHORIZED)]
    fun test_unauthorized_stop_relation() {
        // é follower æˆ– leader å˜—è©¦åœæ­¢é—œä¿‚
        // æ‡‰è©²å¤±æ•—
    }

    #[test]
    fun test_is_risk_acceptable() {
        // é¢¨éšªæ¯”ç‡ = 1.5 (15000 bps) â†’ true
        // é¢¨éšªæ¯”ç‡ = 1.1 (11000 bps) â†’ false
    }

    #[test]
    fun test_calculate_fee_split() {
        // total_fee = 100
        // protocol_rate = 500 (5%)
        // æœŸæœ›: protocol_fee = 5, leader_fee = 95
    }
}
```

è¦æ±‚ï¼š
- è£œä¸Šå…·é«”æ¸¬è©¦é‚è¼¯
- ç¢ºä¿å¯ä»¥é€šé `sui move test` ç·¨è­¯
- ä½¿ç”¨ test_scenario æ­£ç¢ºç®¡ç†æ¸¬è©¦ä¸Šä¸‹æ–‡
```

---

### Prompt 8ï¼šå‰ç«¯å–®å…ƒæ¸¬è©¦

```markdown
# Context
MarginMaster å‰ç«¯éœ€è¦å–®å…ƒæ¸¬è©¦ä¿éšœäº¤æ˜“èˆ‡é¢¨éšªé‚è¼¯çš„æ­£ç¢ºæ€§ã€‚

# Tech Stack
- Testing: Vitest
- React Testing Library
- Mock: vi.mock()

# Task
è«‹ç”Ÿæˆä»¥ä¸‹æ¸¬è©¦æ–‡ä»¶ï¼š

## 1. tests/services/riskEngine.test.ts

```typescript
import { describe, it, expect } from 'vitest';
import {
  calculateRiskMetrics,
  calculateLiquidationPrice,
  generateRiskAlerts,
} from '@/services/riskEngine';

describe('Risk Engine', () => {
  describe('calculateLiquidationPrice', () => {
    it('æ‡‰è©²æ­£ç¢ºè¨ˆç®—æ¸…ç®—åƒ¹æ ¼', () => {
      // æ¸¬è©¦ç”¨ä¾‹
    });

    it('baseBalance ç‚º 0 æ™‚æ‡‰è¿”å› 0', () => {
      // é‚Šç•Œæ¢ä»¶
    });
  });

  describe('generateRiskAlerts', () => {
    it('å¥åº·åº¦ < 30 æ™‚æ‡‰ç”Ÿæˆ danger è­¦å ±', () => {
      // æ¸¬è©¦ç”¨ä¾‹
    });

    it('å¥åº·åº¦ 30-50 æ™‚æ‡‰ç”Ÿæˆ warning è­¦å ±', () => {
      // æ¸¬è©¦ç”¨ä¾‹
    });

    it('å¥åº·åº¦ > 50 æ™‚ä¸æ‡‰ç”Ÿæˆè­¦å ±', () => {
      // æ¸¬è©¦ç”¨ä¾‹
    });
  });
});
```

## 2. tests/components/TradingPanel.test.tsx

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { TradingPanel } from '@/components/trading/TradingPanel';

describe('TradingPanel', () => {
  it('æ‡‰è©²æ¸²æŸ“è¨‚å–®è¡¨å–®', () => {
    // æ¸¬è©¦æ¸²æŸ“
  });

  it('è¼¸å…¥è² æ•¸æ™‚æ‡‰é¡¯ç¤ºéŒ¯èª¤', () => {
    // è¡¨å–®é©—è­‰æ¸¬è©¦
  });

  it('é¢¨éšªéé«˜æ™‚æ‡‰ç¦ç”¨æäº¤æŒ‰éˆ•', () => {
    // Mock é¢¨éšªæ•¸æ“š
    // é©—è­‰æŒ‰éˆ•ç‹€æ…‹
  });

  it('é»æ“Šæäº¤æ‡‰èª¿ç”¨ä¸‹å–®å‡½æ•¸', async () => {
    // Mock executeTransaction
    // é©—è­‰å‡½æ•¸è¢«èª¿ç”¨
  });
});
```

## 3. tests/hooks/useTradingPanel.test.ts

```typescript
import { renderHook, act } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { useTradingPanel } from '@/hooks/useTradingPanel';

describe('useTradingPanel', () => {
  it('æ‡‰è©²è¿”å›åˆå§‹ç‹€æ…‹', () => {
    const { result } = renderHook(() => useTradingPanel());
    expect(result.current.orderType).toBe('MARKET');
  });

  it('æ›´æ–°æ§“æ¡¿æ‡‰æ›´æ–°æ´¾ç”Ÿå€¼', () => {
    // æ¸¬è©¦ç‹€æ…‹æ›´æ–°
  });

  it('ä¸‹å–®æˆåŠŸæ‡‰æ›´æ–°ç‹€æ…‹', async () => {
    // æ¸¬è©¦ç•°æ­¥æ“ä½œ
  });
});
```

è¦æ±‚ï¼š
- ä½¿ç”¨ TypeScript
- ä½¿ç”¨ describe/it çµæ§‹
- åŒ…å«æ–·è¨€å’ŒæœŸæœ›å€¼
- Mock å¤–éƒ¨ä¾è³´
```

---

## æ•´åˆèˆ‡éƒ¨ç½² Prompts

### Prompt 9ï¼šCI/CD é…ç½®

```markdown
# Context
MarginMaster éœ€è¦åŸºæœ¬çš„ CI/CD æµç¨‹ã€‚

# Requirements
- Frontend: GitHub Actions + Vercel
- Contracts: GitHub Actions + Sui Testnet éƒ¨ç½²
- Backend: GitHub Actions + Railway

# Task

## 1. .github/workflows/frontend.yml

```yaml
name: Frontend CI/CD

on:
  pull_request:
    paths:
      - 'frontend/**'
  push:
    branches:
      - main
    paths:
      - 'frontend/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - name: Install dependencies
        run: cd frontend && npm ci
      - name: Run tests
        run: cd frontend && npm test
      - name: Run lint
        run: cd frontend && npm run lint

  deploy:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Vercel
        # TODO: é…ç½® Vercel éƒ¨ç½²
```

## 2. .github/workflows/contracts.yml

```yaml
name: Smart Contracts CI/CD

on:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Sui CLI
        run: |
          # TODO: å®‰è£ Sui CLI
      - name: Build contracts
        run: cd margin_master && sui move build
      - name: Deploy to Testnet
        run: |
          # TODO: é…ç½®ç§é‘°å’Œéƒ¨ç½²å‘½ä»¤
          # sui client publish --gas-budget 500000000
```

## 3. scripts/deploy-contracts.sh

```bash
#!/bin/bash
set -e

NETWORK=${1:-testnet}
GAS_BUDGET=${2:-500000000}

echo "Deploying to $NETWORK..."

# åˆ‡æ›ç¶²çµ¡
sui client switch --env $NETWORK

# æª¢æŸ¥ gas
sui client gas

# ç·¨è­¯
sui move build

# éƒ¨ç½²
RESULT=$(sui client publish --gas-budget $GAS_BUDGET --json)

# æå– Package ID
PACKAGE_ID=$(echo $RESULT | jq -r '.objectChanges[] | select(.type=="published") | .packageId')

echo "âœ… Deployment successful!"
echo "Package ID: $PACKAGE_ID"
echo ""
echo "è«‹å°‡ä»¥ä¸‹å…§å®¹æ·»åŠ åˆ° .env:"
echo "VITE_MARGIN_MASTER_PACKAGE_ID=$PACKAGE_ID"
```

## 4. vercel.json

```json
{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "env": {
    "VITE_SUI_NETWORK": "testnet",
    "VITE_SUI_RPC_URL": "https://fullnode.testnet.sui.io:443",
    "VITE_MARGIN_MASTER_PACKAGE_ID": "@margin_master_package_id"
  }
}
```

è¦æ±‚ï¼š
- åœ¨é—œéµåœ°æ–¹åŠ è¨» TODO
- æä¾›æ¸…æ™°çš„éƒ¨ç½²æ­¥é©Ÿèªªæ˜
```

---

### Prompt 10ï¼šæ–‡æª”ç”Ÿæˆ

```markdown
# Context
ç‚º MarginMaster ç”Ÿæˆé–‹ç™¼è€…æ–‡æª”ï¼Œæ–¹ä¾¿åœ˜éšŠç†è§£èˆ‡åƒèˆ‡ã€‚

# Task

## 1. README.md

```markdown
# MarginMaster

ä¸€å€‹åŸºæ–¼ Sui å€å¡Šéˆå’Œ DeepBook Margin çš„ç¤¾äº¤åŒ–ä¿è­‰é‡‘äº¤æ˜“å¹³å°ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **ç¤¾äº¤è·Ÿå–®**ï¼šä¸€éµè¤‡è£½é ‚å°–äº¤æ˜“è€…çš„ç­–ç•¥
- ğŸ“Š **å¯¦æ™‚æ’è¡Œæ¦œ**ï¼šå¤šç¶­åº¦ç¸¾æ•ˆè©•ä¼°ï¼ˆPnLã€å‹ç‡ã€å¤æ™®æ¯”ç‡ï¼‰
- âš¡ **DeepBook Margin**ï¼šé«˜æ•ˆçš„éˆä¸Šä¿è­‰é‡‘äº¤æ˜“
- ğŸ›¡ï¸ **AI é¢¨éšªç®¡ç†**ï¼šå¯¦æ™‚ç›£æ§ï¼Œè‡ªå‹•è­¦å ±

## ğŸ“¦ é …ç›®çµæ§‹

```
marginmaster/
â”œâ”€â”€ frontend/          # React + TypeScript å‰ç«¯
â”œâ”€â”€ backend/           # Node.js + Express å¾Œç«¯
â”œâ”€â”€ margin_master/     # Sui Move æ™ºèƒ½åˆç´„
â””â”€â”€ docs/              # è¨­è¨ˆæ–‡æª”
```

## ğŸƒ å¿«é€Ÿé–‹å§‹

### å‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

### å¾Œç«¯

```bash
cd backend
npm install
npx prisma migrate dev
npm run dev
```

### æ™ºèƒ½åˆç´„

```bash
cd margin_master
sui move build
sui move test
sui client publish --gas-budget 500000000
```

## ğŸ“š æ–‡æª”

- [æ¶æ§‹è¨­è¨ˆ](./docs/MarginMaster_Architecture.md)
- [æ™ºèƒ½åˆç´„](./docs/MarginMaster_Smart_Contracts.md)
- [API æ–‡æª”](./docs/MarginMaster_Database_API.md)
- [é–‹ç™¼è¨ˆåŠƒ](./docs/MarginMaster_Development_Plan.md)
```

## 2. docs/API_Reference.md

åˆ—å‡ºæ‰€æœ‰å¾Œç«¯ API endpointsï¼š
- ç«¯é»è·¯å¾‘
- è«‹æ±‚åƒæ•¸
- éŸ¿æ‡‰æ ¼å¼
- éŒ¯èª¤ç¢¼
- ä½¿ç”¨ç¤ºä¾‹

## 3. docs/Contract_Guide.md

æ™ºèƒ½åˆç´„ä½¿ç”¨æŒ‡å—ï¼š
- ä¸»è¦æ¨¡çµ„èªªæ˜
- Entry å‡½æ•¸ç”¨é€”
- é‡è¦ Struct å’Œ Event
- å‰ç«¯èª¿ç”¨ç¤ºä¾‹

è¦æ±‚ï¼š
- ä½¿ç”¨æ¸…æ™°çš„ Markdown æ¨™é¡Œ
- ä»£ç¢¼å¡Šä½¿ç”¨èªæ³•é«˜äº®
- åŒ…å«å¯¦éš›å¯é‹è¡Œçš„ç¤ºä¾‹
```

---

## å®‰å…¨æ€§å¯©æŸ¥

### å¿…é ˆäººå·¥æª¢æŸ¥çš„ä»£ç¢¼é¡å‹

#### 1. æ™ºèƒ½åˆç´„å®‰å…¨

```markdown
âš ï¸ é—œéµæª¢æŸ¥é»ï¼š

1. æ¬Šé™æª¢æŸ¥
   âœ… æ­£ç¢ºï¼š
   ```move
   assert!(tx_context::sender(ctx) == relation.follower, E_UNAUTHORIZED);
   ```

   âŒ éŒ¯èª¤ï¼š
   ```move
   // æ²’æœ‰æª¢æŸ¥ senderï¼Œä»»ä½•äººéƒ½èƒ½èª¿ç”¨
   public entry fun stop_relation(relation: CopyTradeRelation) { }
   ```

2. è³‡é‡‘è½‰ç§»
   âœ… æ­£ç¢ºï¼š
   ```move
   let protocol_coin = coin::split(&mut fee_payment, protocol_fee, ctx);
   transfer::public_transfer(protocol_coin, treasury);
   transfer::public_transfer(fee_payment, leader);
   ```

   âŒ éŒ¯èª¤ï¼š
   ```move
   // æ²’æœ‰é©—è­‰é‡‘é¡ï¼Œå¯èƒ½è½‰ç§»éŒ¯èª¤
   transfer::public_transfer(coin, some_address);
   ```

3. æ•¸å€¼è¨ˆç®—
   âœ… æ­£ç¢ºï¼š
   ```move
   let calculated = (quantity * copy_ratio) / BPS_DENOMINATOR;
   assert!(calculated <= max_position, E_EXCEEDS_MAX);
   ```

   âŒ éŒ¯èª¤ï¼š
   ```move
   // å¯èƒ½æº¢å‡ºï¼Œæ²’æœ‰é‚Šç•Œæª¢æŸ¥
   let result = a * b / c;
   ```

4. Loop æ“ä½œï¼ˆGas é¢¨éšªï¼‰
   âš ï¸ è¬¹æ…ä½¿ç”¨ï¼š
   ```move
   // é¿å…å¤§é‡å¾ªç’°ï¼Œä½¿ç”¨äº‹ä»¶é©…å‹•
   while (i < followers.length()) {  // å¦‚æœ followers å¾ˆå¤šæœƒè€—ç›¡ Gas
       // ...
   }
   ```
```

#### 2. å‰ç«¯å®‰å…¨

```markdown
1. ç”¨æˆ¶è¼¸å…¥é©—è­‰
   âœ… æ­£ç¢ºï¼š
   ```typescript
   const schema = z.object({
     quantity: z.number().positive().max(1000000),
     leverage: z.number().min(1).max(10),
   });
   ```

   âŒ éŒ¯èª¤ï¼š
   ```typescript
   // ç›´æ¥ä½¿ç”¨æœªé©—è­‰çš„è¼¸å…¥
   placeOrder({ quantity: userInput });
   ```

2. äº¤æ˜“ç°½å
   âœ… æ­£ç¢ºï¼š
   ```typescript
   const result = await executeTransaction(tx);
   if (result.effects?.status?.status !== 'success') {
     throw new Error('Transaction failed');
   }
   ```

   âŒ éŒ¯èª¤ï¼š
   ```typescript
   // æ²’æœ‰æª¢æŸ¥äº¤æ˜“çµæœ
   await executeTransaction(tx);
   // å‡è¨­æˆåŠŸ...
   ```
```

#### 3. å¾Œç«¯å®‰å…¨

```markdown
1. SQL æ³¨å…¥é˜²è­·
   âœ… æ­£ç¢ºï¼ˆä½¿ç”¨ Prismaï¼‰ï¼š
   ```typescript
   const trades = await prisma.trade.findMany({
     where: { userId: userAddress },
   });
   ```

   âŒ éŒ¯èª¤ï¼ˆåŸå§‹ SQLï¼‰ï¼š
   ```typescript
   const trades = await db.query(
     `SELECT * FROM trades WHERE user_id = '${userAddress}'`
   );
   ```

2. Rate Limiting
   âœ… æ­£ç¢ºï¼š
   ```typescript
   import rateLimit from 'express-rate-limit';

   const limiter = rateLimit({
     windowMs: 15 * 60 * 1000,
     max: 100,
   });

   app.use('/api/', limiter);
   ```
```

---

## å¸¸è¦‹éŒ¯èª¤èˆ‡ä¿®æ­£

### AGI å¸¸è¦‹éŒ¯èª¤æ¨¡å¼

```markdown
âŒ éŒ¯èª¤ 1ï¼šå¿˜è¨˜è™•ç† async/await éŒ¯èª¤

éŒ¯èª¤ä»£ç¢¼ï¼š
```typescript
async function placeOrder() {
  const result = await executeTransaction(tx);
  return result;
}
```

âœ… ä¿®æ­£ Promptï¼š
ã€Œè«‹ç‚ºæ‰€æœ‰ async å‡½æ•¸æ·»åŠ  try-catch éŒ¯èª¤è™•ç†ï¼Œä¸¦æä¾›æœ‰æ„ç¾©çš„éŒ¯èª¤æ¶ˆæ¯ã€

ä¿®æ­£ä»£ç¢¼ï¼š
```typescript
async function placeOrder() {
  try {
    const result = await executeTransaction(tx);
    return result;
  } catch (error) {
    console.error('Order placement failed:', error);
    throw new Error(`Failed to place order: ${error.message}`);
  }
}
```

---

âŒ éŒ¯èª¤ 2ï¼šç¡¬ç·¨ç¢¼å¸¸æ•¸

éŒ¯èª¤ä»£ç¢¼ï¼š
```typescript
const PACKAGE_ID = '0xabcd1234...';
tx.moveCall({
  target: `${PACKAGE_ID}::copy_trade::create_relation`,
});
```

âœ… ä¿®æ­£ Promptï¼š
ã€Œè«‹ç§»é™¤æ‰€æœ‰ç¡¬ç·¨ç¢¼çš„åœ°å€å’Œ IDï¼Œæ”¹ç‚ºå¾ç’°å¢ƒè®Šæ•¸è®€å–ã€

ä¿®æ­£ä»£ç¢¼ï¼š
```typescript
const PACKAGE_ID = import.meta.env.VITE_MARGIN_MASTER_PACKAGE_ID;
if (!PACKAGE_ID) {
  throw new Error('VITE_MARGIN_MASTER_PACKAGE_ID not configured');
}
```

---

âŒ éŒ¯èª¤ 3ï¼šä½¿ç”¨ any é¡å‹

éŒ¯èª¤ä»£ç¢¼ï¼š
```typescript
function processTradeData(data: any) {
  return data.quantity * data.price;
}
```

âœ… ä¿®æ­£ Promptï¼š
ã€Œè«‹ç§»é™¤æ‰€æœ‰ any é¡å‹ï¼Œæ”¹ç”¨å…·é«”çš„ TypeScript æ¥å£å®šç¾©ã€

ä¿®æ­£ä»£ç¢¼ï¼š
```typescript
interface TradeData {
  quantity: number;
  price: number;
  side: 'BUY' | 'SELL';
}

function processTradeData(data: TradeData): number {
  return data.quantity * data.price;
}
```

---

âŒ éŒ¯èª¤ 4ï¼šç¼ºå°‘é‚Šç•Œæª¢æŸ¥

éŒ¯èª¤ä»£ç¢¼ï¼š
```typescript
function calculateFee(amount: number, rate: number) {
  return amount * rate / 10000;
}
```

âœ… ä¿®æ­£ Promptï¼š
ã€Œè«‹ç‚ºæ‰€æœ‰ç”¨æˆ¶è¼¸å…¥æ·»åŠ é‚Šç•Œæª¢æŸ¥èˆ‡éŒ¯èª¤æç¤ºã€

ä¿®æ­£ä»£ç¢¼ï¼š
```typescript
function calculateFee(amount: number, rate: number): number {
  if (amount < 0) {
    throw new Error('Amount must be positive');
  }
  if (rate < 0 || rate > 10000) {
    throw new Error('Rate must be between 0 and 10000 basis points');
  }
  return amount * rate / 10000;
}
```

---

âŒ éŒ¯èª¤ 5ï¼šå‰ç«¯æª¢æŸ¥ä½†åˆç´„æœªæª¢æŸ¥

éŒ¯èª¤æƒ…æ³ï¼š
```typescript
// å‰ç«¯æœ‰æª¢æŸ¥
if (riskRatio < 1.2) {
  alert('Risk too high!');
  return;
}
```

ä½†æ™ºèƒ½åˆç´„æ²’æœ‰ç›¸æ‡‰æª¢æŸ¥ï¼Œæ”»æ“Šè€…å¯ä»¥ç›´æ¥èª¿ç”¨åˆç´„ç¹éã€‚

âœ… ä¿®æ­£ Promptï¼š
ã€Œè«‹åœ¨æ™ºèƒ½åˆç´„å±¤é‡è¤‡é©—è­‰æ‰€æœ‰é—œéµç´„æŸï¼Œä¸è¦åªä¾è³´å‰ç«¯æª¢æŸ¥ã€

ä¿®æ­£ä»£ç¢¼ï¼š
```move
public entry fun execute_copy_trade(
    risk_ratio_bps: u64,
    ctx: &mut TxContext
) {
    assert!(risk_ratio_bps >= MIN_RISK_RATIO_BPS, E_RISK_TOO_HIGH);
    // ...
}
```
```

---

## æœ€ä½³å¯¦è¸

### ä»£ç¢¼å¯©æŸ¥æ¸…å–®

```markdown
æäº¤ä»£ç¢¼å‰æª¢æŸ¥ï¼š

â–¡ TypeScript é¡å‹å®Œæ•´ï¼ˆç„¡ anyï¼‰
â–¡ æ‰€æœ‰ async å‡½æ•¸åŒ…å«éŒ¯èª¤è™•ç†
â–¡ å¤–éƒ¨è¼¸å…¥å·²é©—è­‰
â–¡ é‡‘é¡è¨ˆç®—ä½¿ç”¨ BigNumber/Decimal
â–¡ æ™ºèƒ½åˆç´„åŒ…å«æ¬Šé™æª¢æŸ¥
â–¡ é—œéµé‚è¼¯æœ‰å–®å…ƒæ¸¬è©¦
â–¡ å…¬é–‹å‡½æ•¸æœ‰ JSDoc è¨»é‡‹
â–¡ ç’°å¢ƒè®Šæ•¸æ­£ç¢ºé…ç½®ï¼ˆç„¡ç¡¬ç·¨ç¢¼ï¼‰
â–¡ Git commit å‰è‡ªæ¸¬é€šé
```

### å¢é‡é–‹ç™¼æ™‚é–“è¡¨

```markdown
Day 1:
  âœ… Prompt 1: é …ç›®åˆå§‹åŒ–
  âœ… Prompt 2: éŒ¢åŒ…é€£æ¥
  â†’ å¯©æŸ¥ + commit

Day 2:
  âœ… Prompt 3: äº¤æ˜“ç•Œé¢
  â†’ å¯©æŸ¥ + commit

Day 3:
  âœ… Prompt 4: è·Ÿå–®æ™ºèƒ½åˆç´„
  âœ… Prompt 7: åˆç´„æ¸¬è©¦
  â†’ å¯©æŸ¥ + ä¿®æ­£

Day 4:
  âœ… Prompt 5: æ’è¡Œæ¦œç³»çµ±
  â†’ å¯©æŸ¥ + commit

Day 5:
  âœ… Prompt 6: é¢¨éšªç®¡ç†
  âœ… Prompt 8: å‰ç«¯æ¸¬è©¦
  â†’ å¯©æŸ¥ + ä¿®æ­£

Day 6:
  â†’ æ•´åˆã€Bug ä¿®å¾©ã€é«”é©—å„ªåŒ–

Day 7:
  âœ… Prompt 9: CI/CD
  âœ… Prompt 10: æ–‡æª”
  â†’ Demo æº–å‚™
```

### ä¸Šä¸‹æ–‡ç®¡ç†æŠ€å·§

```markdown
æ¯æ¬¡èˆ‡ AGI é–‹æ–°å°è©±æ™‚æä¾›ï¼š

# Project Context
- Project: MarginMaster
- Goal: [å…·é«”ç›®æ¨™]
- Tech Stack: React + TS, Sui Move, Node.js, PostgreSQL

# Current State
- Completed: [å·²å®Œæˆæ¨¡çµ„]
- Current Files: [ç›¸é—œæ–‡ä»¶çµæ§‹]

# Task
[å…·é«”è¦æ±‚]

# Constraints
- TypeScriptï¼ˆç„¡ anyï¼‰
- æ‰€æœ‰é‡‘é¡ä½¿ç”¨ BigNumber
- åŒ…å«éŒ¯èª¤è™•ç†å’Œæ¸¬è©¦
```

### Debugging Prompt æ¨¡æ¿

```markdown
# Debugging Request

æˆ‘åœ¨ MarginMaster é …ç›®ä¸­é‡åˆ°ä»¥ä¸‹éŒ¯èª¤ï¼š

**éŒ¯èª¤è¨Šæ¯ï¼š**
```
[å®Œæ•´éŒ¯èª¤æ—¥èªŒ]
```

**ç›¸é—œä»£ç¢¼ï¼š**
```typescript
[è²¼ä¸Šä»£ç¢¼æ®µ]
```

**å·²å˜—è©¦çš„æ–¹æ¡ˆï¼š**
1. [æ–¹æ¡ˆ 1]
2. [æ–¹æ¡ˆ 2]

**æœŸæœ›è¡Œç‚ºï¼š**
[æè¿°æœŸæœ›çš„é‹è¡Œçµæœ]

è«‹å¹«æˆ‘ï¼š
1. è§£é‡‹éŒ¯èª¤ç™¼ç”Ÿçš„æ ¹æœ¬åŸå› 
2. æä¾›ä¿®æ­£å¾Œçš„å®Œæ•´ä»£ç¢¼
3. è§£é‡‹ä¿®æ­£çš„é‚è¼¯
4. çµ¦å‡ºå¦‚ä½•é¿å…é¡ä¼¼éŒ¯èª¤çš„å»ºè­°
```

---

## ğŸ¯ å¿«é€Ÿåƒè€ƒ

### å¸¸ç”¨ Prompt é–‹é ­æ¨¡æ¿

```markdown
1. ã€Œè«‹å¹«æˆ‘ç”Ÿæˆ...ã€        â†’ ç”¨æ–¼æ–°åŠŸèƒ½/æ¨¡çµ„
2. ã€Œè«‹é‡æ§‹ä»¥ä¸‹ä»£ç¢¼...ã€     â†’ ç”¨æ–¼å„ªåŒ–æ—¢æœ‰ä»£ç¢¼
3. ã€Œè«‹ç‚ºä»¥ä¸‹ä»£ç¢¼æ·»åŠ æ¸¬è©¦...ã€ â†’ æ¸¬è©¦è¦†è“‹
4. ã€Œè«‹å¯©è¨ˆä»¥ä¸‹ä»£ç¢¼çš„å®‰å…¨æ€§...ã€â†’ å®‰å…¨æª¢æŸ¥
5. ã€Œè«‹è§£é‡‹ä»¥ä¸‹éŒ¯èª¤...ã€     â†’ Debug
6. ã€Œè«‹å„ªåŒ–ä»¥ä¸‹ä»£ç¢¼çš„æ€§èƒ½...ã€ â†’ æ€§èƒ½å„ªåŒ–
7. ã€Œè«‹ç‚ºä»¥ä¸‹ä»£ç¢¼å¯«æ–‡æª”...ã€  â†’ è£œæ–‡æª”å’Œè¨»é‡‹
```

### Do's & Don'ts

#### âœ… Do's

- æ˜ç¢ºå‘Šè¨´ AGI é …ç›®èƒŒæ™¯èˆ‡æŠ€è¡“æ£§
- ä¸€æ¬¡åªè™•ç†ä¸€å€‹æ¸…æ™°çš„å­å•é¡Œ
- è¦æ±‚åŒæ™‚ç”Ÿæˆæ¸¬è©¦èˆ‡è¨»é‡‹
- åœ¨è³‡é‡‘ç›¸é—œé‚è¼¯ä¸Šé€²è¡Œäººå·¥å¯©æŸ¥
- é€æ­¥æ•´åˆèˆ‡æ¸¬è©¦ï¼Œé¿å…å¤§æ”¹

#### âŒ Don'ts

- ä¸è¦ç›²ç›®ç›¸ä¿¡ AGI çš„åˆç´„é‚è¼¯
- ä¸è¦å…è¨± any é¡å‹æ³›æ¿«
- ä¸è¦è·³ééŒ¯èª¤è™•ç†èˆ‡é‚Šç•Œæ¸¬è©¦
- ä¸è¦åœ¨ Prompt ä¸­çµ¦æ¨¡ç³Šè¦æ±‚
- ä¸è¦ä¸€æ¬¡æ€§è¦æ±‚å¤ªå¤šåŠŸèƒ½

---

**ä¸‹ä¸€æ­¥é–±è®€**ï¼š
- [é–‹ç™¼è¨ˆåŠƒ](./MarginMaster_Development_Plan.md) - 7 å¤©å¯¦æ–½æ™‚é–“è¡¨
- [æ™ºèƒ½åˆç´„è¨­è¨ˆ](./MarginMaster_Smart_Contracts.md) - å®Œæ•´åˆç´„ä»£ç¢¼
- [å¾Œç«¯æ¶æ§‹](./MarginMaster_Backend.md) - å¾Œç«¯å¯¦ç¾ç´°ç¯€
