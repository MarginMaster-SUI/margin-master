# MarginMaster - ç³»çµ±æ¶æ§‹è¨­è¨ˆ

> **ç‰ˆæœ¬:** 2.0
> **æ—¥æœŸ:** 2026-02-02
> **ç‹€æ…‹:** Ready for Implementation

---

## ğŸ“‹ ç›®éŒ„

1. [æ¶æ§‹æ¦‚è¦½](#æ¶æ§‹æ¦‚è¦½)
2. [æŠ€è¡“æ£§è©³è§£](#æŠ€è¡“æ£§è©³è§£)
3. [æ•¸æ“šæµè¨­è¨ˆ](#æ•¸æ“šæµè¨­è¨ˆ)
4. [æ¨¡çµ„åŠƒåˆ†](#æ¨¡çµ„åŠƒåˆ†)
5. [åŸºç¤è¨­æ–½](#åŸºç¤è¨­æ–½)
6. [å®‰å…¨æ€§è¨­è¨ˆ](#å®‰å…¨æ€§è¨­è¨ˆ)
7. [æ€§èƒ½å„ªåŒ–](#æ€§èƒ½å„ªåŒ–)
8. [ç›£æ§èˆ‡æ—¥èªŒ](#ç›£æ§èˆ‡æ—¥èªŒ)

---

## æ¶æ§‹æ¦‚è¦½

### é«˜å±¤æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ¶ç•Œé¢å±¤ (Web App)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚äº¤æ˜“é¢æ¿  â”‚  â”‚æ’è¡Œæ¦œ    â”‚  â”‚è·Ÿå–®ç®¡ç†  â”‚  â”‚é¢¨éšªå„€è¡¨æ¿â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚å€‹äººæª”æ¡ˆ  â”‚  â”‚é€šçŸ¥ä¸­å¿ƒ  â”‚  â”‚æ¨¡æ“¬æ¨¡å¼  â”‚  â”‚è¨­ç½®é é¢  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTPS/WSS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ‡‰ç”¨é‚è¼¯å±¤ (React + TypeScript)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚å…¨å±€ç‹€æ…‹  â”‚  â”‚APIå®¢æˆ¶ç«¯ â”‚  â”‚éŒ¢åŒ…ç®¡ç†  â”‚  â”‚äº‹ä»¶è¨‚é–±  â”‚         â”‚
â”‚  â”‚(Zustand) â”‚  â”‚(React    â”‚  â”‚(@mysten/ â”‚  â”‚(SuiClientâ”‚         â”‚
â”‚  â”‚          â”‚  â”‚ Query)   â”‚  â”‚ dapp-kit)â”‚  â”‚ Events)  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚é¢¨éšªå¼•æ“  â”‚  â”‚åœ–è¡¨çµ„ä»¶  â”‚  â”‚æœ¬åœ°å¿«å–  â”‚  â”‚éŒ¯èª¤è™•ç†  â”‚         â”‚
â”‚  â”‚(Client)  â”‚  â”‚(Recharts)â”‚  â”‚(IndexedDBâ”‚  â”‚(Sentry)  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• JSON-RPC / REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¾Œç«¯æœå‹™å±¤ (Node.js)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚REST API  â”‚  â”‚äº‹ä»¶ç´¢å¼•å™¨â”‚  â”‚æ’è¡Œæ¦œ    â”‚  â”‚é€šçŸ¥æœå‹™  â”‚         â”‚
â”‚  â”‚Server    â”‚  â”‚(Sui      â”‚  â”‚è¨ˆç®—å™¨    â”‚  â”‚(Novu)    â”‚         â”‚
â”‚  â”‚(Express) â”‚  â”‚ Events)  â”‚  â”‚(Cron)    â”‚  â”‚          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚è·Ÿå–®åŸ·è¡Œå™¨â”‚  â”‚åƒ¹æ ¼æœå‹™  â”‚  â”‚é¢¨éšªç›£æ§  â”‚  â”‚åˆ†ææœå‹™  â”‚         â”‚
â”‚  â”‚(BullMQ   â”‚  â”‚(Pyth +   â”‚  â”‚Keeper    â”‚  â”‚(Mixpanel)â”‚         â”‚
â”‚  â”‚ Worker)  â”‚  â”‚ DeepBook)â”‚  â”‚          â”‚  â”‚          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• SQL / Redis
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•¸æ“šå­˜å„²å±¤                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  PostgreSQL 16       â”‚  â”‚  Redis 7.2           â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚  â”‚ç”¨æˆ¶è¡¨          â”‚  â”‚  â”‚  â”‚æ’è¡Œæ¦œå¿«å–      â”‚ â”‚              â”‚
â”‚  â”‚  â”‚è·Ÿå–®é—œä¿‚è¡¨      â”‚  â”‚  â”‚  â”‚å¯¦æ™‚åƒ¹æ ¼        â”‚ â”‚              â”‚
â”‚  â”‚  â”‚äº¤æ˜“è¨˜éŒ„è¡¨      â”‚  â”‚  â”‚  â”‚ä»»å‹™éšŠåˆ—        â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ç¸¾æ•ˆçµ±è¨ˆè¡¨      â”‚  â”‚  â”‚  â”‚æœƒè©±æ•¸æ“š        â”‚ â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Move Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ™ºèƒ½åˆç´„å±¤ (Sui Move)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  margin_master Package                              â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚          â”‚
â”‚  â”‚  â”‚copy_tradeâ”‚  â”‚trader_   â”‚  â”‚fee_      â”‚         â”‚          â”‚
â”‚  â”‚  â”‚          â”‚  â”‚profile   â”‚  â”‚manager   â”‚         â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚          â”‚
â”‚  â”‚  â”‚risk_     â”‚  â”‚emergency_â”‚  â”‚user_     â”‚         â”‚          â”‚
â”‚  â”‚  â”‚checker   â”‚  â”‚pause     â”‚  â”‚registry  â”‚         â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Margin Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DeepBook Margin Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Margin    â”‚  â”‚Pool      â”‚  â”‚Order     â”‚  â”‚Liquidationâ”‚        â”‚
â”‚  â”‚Manager   â”‚  â”‚Proxy     â”‚  â”‚Book      â”‚  â”‚Engine     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•¸æ“šç´¢å¼•å±¤ (æ··åˆæ–¹æ¡ˆ)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Surflux Indexer      â”‚  â”‚ è‡ªå»ºäº‹ä»¶ç´¢å¼•å™¨       â”‚              â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚  â”‚ â”‚DeepBook äº¤æ˜“   â”‚   â”‚  â”‚ â”‚è·Ÿå–®äº‹ä»¶        â”‚   â”‚              â”‚
â”‚  â”‚ â”‚åƒ¹æ ¼è¡Œæƒ…        â”‚   â”‚  â”‚ â”‚é¢¨éšªäº‹ä»¶        â”‚   â”‚              â”‚
â”‚  â”‚ â”‚æµå‹•æ€§æ•¸æ“š      â”‚   â”‚  â”‚ â”‚ç¸¾æ•ˆæ›´æ–°        â”‚   â”‚              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœå‹™å±¤                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Pyth      â”‚  â”‚Sui RPC   â”‚  â”‚IPFS      â”‚  â”‚Novu      â”‚         â”‚
â”‚  â”‚Oracle    â”‚  â”‚Node      â”‚  â”‚(Pinata)  â”‚  â”‚Notification       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ§‹è¨­è¨ˆåŸå‰‡

#### 1. åˆ†å±¤æ¶æ§‹ (Layered Architecture)

**ç›®æ¨™**ï¼šè·è²¬åˆ†é›¢ï¼Œé™ä½è€¦åˆ

```
å±•ç¤ºå±¤ (Presentation)
    â†“ åªèª¿ç”¨æ‡‰ç”¨å±¤
æ‡‰ç”¨å±¤ (Application)
    â†“ åªèª¿ç”¨é ˜åŸŸå±¤
é ˜åŸŸå±¤ (Domain / Smart Contracts)
    â†“ åªèª¿ç”¨åŸºç¤è¨­æ–½å±¤
åŸºç¤è¨­æ–½å±¤ (Infrastructure)
```

**å„ªå‹¢**ï¼š
- âœ… æ¯å±¤å¯ç¨ç«‹æ¸¬è©¦
- âœ… æ˜“æ–¼æ›¿æ›å¯¦ç¾
- âœ… æ¸…æ™°çš„ä¾è³´æ–¹å‘

#### 2. äº‹ä»¶é©…å‹•æ¶æ§‹ (Event-Driven)

**æ ¸å¿ƒç†å¿µ**ï¼šé€šéäº‹ä»¶è§£è€¦æ¨¡çµ„

```
äº‹ä»¶ç™¼å¸ƒè€… â†’ äº‹ä»¶ç¸½ç·š â†’ äº‹ä»¶è¨‚é–±è€…
    â†“
ä¸éœ€è¦çŸ¥é“è¨‚é–±è€…çš„å­˜åœ¨
```

**æ‡‰ç”¨å ´æ™¯**ï¼š
- Leader äº¤æ˜“ â†’ è·Ÿå–®åŸ·è¡Œ
- é¢¨éšªè®ŠåŒ– â†’ é€šçŸ¥æ¨é€
- ç¸¾æ•ˆæ›´æ–° â†’ æ’è¡Œæ¦œåˆ·æ–°

**å„ªå‹¢**ï¼š
- âœ… é«˜åº¦è§£è€¦
- âœ… æ˜“æ–¼æ“´å±•
- âœ… ç•°æ­¥è™•ç†

#### 3. å¾®æœå‹™åŒ– (Microservices-Ready)

**ç•¶å‰ç‹€æ…‹**ï¼šå–®é«”æ‡‰ç”¨ï¼ˆHackathonï¼‰

**æœªä¾†æ¼”é€²**ï¼š
```
Phase 1 (ç¾åœ¨)ï¼š
â””â”€ Monolith (Express + Workers)

Phase 2 (3-6 å€‹æœˆ)ï¼š
â”œâ”€ API Gateway
â”œâ”€ Trading Service
â”œâ”€ Copy Trade Service
â”œâ”€ Analytics Service
â””â”€ Notification Service
```

---

## æŠ€è¡“æ£§è©³è§£

### å‰ç«¯æŠ€è¡“æ£§

#### æ ¸å¿ƒæ¡†æ¶

**React 18.2+ with TypeScript**

é¸æ“‡ç†ç”±ï¼š
- âœ… æˆç†Ÿçš„ç”Ÿæ…‹ç³»çµ±
- âœ… å„ªç§€çš„ TypeScript æ”¯æŒ
- âœ… è±å¯Œçš„ Sui éŒ¢åŒ…é›†æˆåº«
- âœ… åœ˜éšŠç†Ÿæ‚‰åº¦é«˜

æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- âŒ Vue 3ï¼šSui ç”Ÿæ…‹é›†æˆè¼ƒå°‘
- âŒ Svelteï¼šç”Ÿæ…‹ç³»çµ±è¼ƒå°
- âš ï¸ Next.jsï¼šè€ƒæ…®ç”¨æ–¼ SSR å„ªåŒ–ï¼ˆPhase 2ï¼‰

#### æ§‹å»ºå·¥å…·

**Vite 5.0+**

é¸æ“‡ç†ç”±ï¼š
- âœ… æ¥µå¿«çš„å†·å•Ÿå‹•é€Ÿåº¦
- âœ… ç†±æ¨¡å¡Šæ›¿æ› (HMR)
- âœ… åŸç”Ÿ TypeScript æ”¯æŒ
- âœ… å„ªåŒ–çš„ç”Ÿç”¢æ§‹å»º

é…ç½®ç¤ºä¾‹ï¼š
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nodePolyfills } from 'vite-plugin-node-polyfills';

export default defineConfig({
  plugins: [
    react(),
    nodePolyfills(), // Sui SDK éœ€è¦
  ],
  resolve: {
    alias: {
      '@': '/src',
    },
  },
  define: {
    'process.env': {},
  },
  optimizeDeps: {
    include: ['@mysten/sui.js'],
  },
});
```

#### ç‹€æ…‹ç®¡ç†

**1. å…¨å±€ç‹€æ…‹ï¼šZustand 4.4+**

é¸æ“‡ç†ç”±ï¼š
- âœ… è¼•é‡ç´šï¼ˆ~1KBï¼‰
- âœ… ç„¡éœ€ Provider åŒ…è£¹
- âœ… TypeScript å‹å¥½
- âœ… DevTools æ”¯æŒ

æ¶æ§‹è¨­è¨ˆï¼š
```typescript
// store/index.ts
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';

interface AppState {
  // ç”¨æˆ¶ç‹€æ…‹
  user: User | null;
  setUser: (user: User | null) => void;

  // éŒ¢åŒ…ç‹€æ…‹
  walletAddress: string | null;
  isWalletConnected: boolean;

  // UI ç‹€æ…‹
  isDemoMode: boolean;
  toggleDemoMode: () => void;

  // é€šçŸ¥
  notifications: Notification[];
  addNotification: (notification: Notification) => void;
}

export const useAppStore = create<AppState>()(
  devtools(
    persist(
      (set) => ({
        user: null,
        setUser: (user) => set({ user }),

        walletAddress: null,
        isWalletConnected: false,

        isDemoMode: false,
        toggleDemoMode: () => set((state) => ({
          isDemoMode: !state.isDemoMode
        })),

        notifications: [],
        addNotification: (notification) => set((state) => ({
          notifications: [...state.notifications, notification]
        })),
      }),
      { name: 'margin-master-storage' }
    )
  )
);
```

**2. æœå‹™ç«¯ç‹€æ…‹ï¼šTanStack Query 5.0+**

é¸æ“‡ç†ç”±ï¼š
- âœ… è‡ªå‹•å¿«å–ç®¡ç†
- âœ… å¾Œå°é‡æ–°é©—è­‰
- âœ… æ¨‚è§€æ›´æ–°
- âœ… ç„¡é™æ»¾å‹•æ”¯æŒ

ä½¿ç”¨æ¨¡å¼ï¼š
```typescript
// hooks/useLeaderboard.ts
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';

export function useLeaderboard(params?: LeaderboardParams) {
  return useQuery({
    queryKey: ['leaderboard', params],
    queryFn: () => api.getLeaderboard(params),
    staleTime: 30_000, // 30 ç§’å…§èªç‚ºæ•¸æ“šæ–°é®®
    refetchInterval: 60_000, // æ¯åˆ†é˜åˆ·æ–°
  });
}

export function useTraderProfile(address: string) {
  return useQuery({
    queryKey: ['trader', address],
    queryFn: () => api.getTraderProfile(address),
    enabled: !!address,
  });
}
```

**3. è¡¨å–®ç‹€æ…‹ï¼šReact Hook Form 7.48+**

é¸æ“‡ç†ç”±ï¼š
- âœ… æ€§èƒ½å„ªç•°ï¼ˆéå—æ§çµ„ä»¶ï¼‰
- âœ… èˆ‡ Zod å®Œç¾é›†æˆ
- âœ… éˆæ´»çš„é©—è­‰è¦å‰‡

ä½¿ç”¨ç¤ºä¾‹ï¼š
```typescript
// components/OrderForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const orderSchema = z.object({
  quantity: z.number().positive('æ•¸é‡å¿…é ˆå¤§æ–¼ 0'),
  price: z.number().positive().optional(),
  leverage: z.number().min(1).max(10),
  stopLoss: z.number().positive().optional(),
});

type OrderFormData = z.infer<typeof orderSchema>;

export function OrderForm() {
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<OrderFormData>({
    resolver: zodResolver(orderSchema),
  });

  const onSubmit = (data: OrderFormData) => {
    // è™•ç†æäº¤
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* è¡¨å–®å­—æ®µ */}
    </form>
  );
}
```

#### éŒ¢åŒ…é›†æˆ

**@mysten/dapp-kit 0.14+**

æ¶æ§‹è¨­è¨ˆï¼š
```typescript
// App.tsx
import { SuiClientProvider, WalletProvider } from '@mysten/dapp-kit';
import { getFullnodeUrl } from '@mysten/sui.js/client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const queryClient = new QueryClient();

const networks = {
  devnet: { url: getFullnodeUrl('devnet') },
  testnet: { url: getFullnodeUrl('testnet') },
  mainnet: { url: getFullnodeUrl('mainnet') },
};

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <SuiClientProvider networks={networks} defaultNetwork="testnet">
        <WalletProvider autoConnect>
          <Router />
        </WalletProvider>
      </SuiClientProvider>
    </QueryClientProvider>
  );
}
```

è‡ªå®šç¾© Hookï¼š
```typescript
// hooks/useWallet.ts
import { useCurrentAccount, useSignAndExecuteTransactionBlock } from '@mysten/dapp-kit';
import { TransactionBlock } from '@mysten/sui.js/transactions';

export function useWallet() {
  const account = useCurrentAccount();
  const { mutateAsync: signAndExecute } = useSignAndExecuteTransactionBlock();

  const executeTransaction = async (tx: TransactionBlock) => {
    if (!account) {
      throw new Error('éŒ¢åŒ…æœªé€£æ¥');
    }

    const result = await signAndExecute({
      transactionBlock: tx,
      options: {
        showEffects: true,
        showObjectChanges: true,
      },
    });

    if (result.effects?.status?.status !== 'success') {
      throw new Error(`äº¤æ˜“å¤±æ•—: ${result.effects?.status?.error}`);
    }

    return result;
  };

  return {
    address: account?.address,
    isConnected: !!account,
    executeTransaction,
  };
}
```

---

### å¾Œç«¯æŠ€è¡“æ£§

#### é‹è¡Œæ™‚èˆ‡æ¡†æ¶

**Node.js 20 LTS + Express 4.18**

é …ç›®çµæ§‹ï¼š
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/               # REST API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ leaderboard.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ traders.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ copy-trades.ts
â”‚   â”‚   â”‚   â””â”€â”€ risk.ts
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â”œâ”€â”€ auth.ts
â”‚   â”‚       â”œâ”€â”€ rateLimit.ts
â”‚   â”‚       â””â”€â”€ errorHandler.ts
â”‚   â”œâ”€â”€ services/          # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ copyTrade/
â”‚   â”‚   â”‚   â”œâ”€â”€ executor.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ validator.ts
â”‚   â”‚   â”‚   â””â”€â”€ calculator.ts
â”‚   â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ calculator.ts
â”‚   â”‚   â”‚   â””â”€â”€ ranker.ts
â”‚   â”‚   â”œâ”€â”€ risk/
â”‚   â”‚   â”‚   â”œâ”€â”€ monitor.ts
â”‚   â”‚   â”‚   â””â”€â”€ alerter.ts
â”‚   â”‚   â””â”€â”€ notification/
â”‚   â”‚       â””â”€â”€ sender.ts
â”‚   â”œâ”€â”€ workers/           # å¾Œå°ä»»å‹™
â”‚   â”‚   â”œâ”€â”€ copyTradeWorker.ts
â”‚   â”‚   â”œâ”€â”€ riskMonitorWorker.ts
â”‚   â”‚   â””â”€â”€ leaderboardWorker.ts
â”‚   â”œâ”€â”€ indexers/          # äº‹ä»¶ç›£è½
â”‚   â”‚   â”œâ”€â”€ suiEventListener.ts
â”‚   â”‚   â””â”€â”€ deepbookIndexer.ts
â”‚   â”œâ”€â”€ lib/               # å·¥å…·åº«
â”‚   â”‚   â”œâ”€â”€ prisma.ts
â”‚   â”‚   â”œâ”€â”€ redis.ts
â”‚   â”‚   â”œâ”€â”€ suiClient.ts
â”‚   â”‚   â””â”€â”€ logger.ts
â”‚   â”œâ”€â”€ types/             # TypeScript é¡å‹
â”‚   â””â”€â”€ config/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma
â”œâ”€â”€ tests/
â””â”€â”€ package.json
```

Express é…ç½®ï¼š
```typescript
// src/api/index.ts
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import compression from 'compression';
import { errorHandler } from './middleware/errorHandler';
import { rateLimit } from './middleware/rateLimit';
import routes from './routes';

const app = express();

// ä¸­é–“ä»¶
app.use(helmet());
app.use(cors({
  origin: process.env.FRONTEND_URL,
  credentials: true,
}));
app.use(compression());
app.use(express.json());
app.use(rateLimit);

// è·¯ç”±
app.use('/api', routes);

// éŒ¯èª¤è™•ç†
app.use(errorHandler);

export default app;
```

#### ä»»å‹™éšŠåˆ—

**BullMQ 5.0+ with Redis**

æ¶æ§‹è¨­è¨ˆï¼š
```typescript
// lib/queue.ts
import { Queue, Worker, QueueEvents } from 'bullmq';
import { redis } from './redis';

export const copyTradeQueue = new Queue('copy-trade-execution', {
  connection: redis,
  defaultJobOptions: {
    attempts: 3,
    backoff: {
      type: 'exponential',
      delay: 2000,
    },
    removeOnComplete: {
      count: 100,
      age: 3600, // 1 å°æ™‚
    },
    removeOnFail: {
      count: 1000,
      age: 86400, // 24 å°æ™‚
    },
  },
});

export const riskMonitorQueue = new Queue('risk-monitor', {
  connection: redis,
});

export const leaderboardQueue = new Queue('leaderboard-calculation', {
  connection: redis,
});
```

Worker å¯¦ç¾ï¼š
```typescript
// workers/copyTradeWorker.ts
import { Worker, Job } from 'bullmq';
import { redis } from '@/lib/redis';
import { CopyTradeExecutor } from '@/services/copyTrade/executor';

const executor = new CopyTradeExecutor();

export const copyTradeWorker = new Worker(
  'copy-trade-execution',
  async (job: Job) => {
    const { leaderAddress, followerAddress, tradeSignal } = job.data;

    try {
      await executor.executeCopyTrade({
        leaderAddress,
        followerAddress,
        tradeSignal,
      });

      return { status: 'success' };
    } catch (error) {
      console.error('è·Ÿå–®åŸ·è¡Œå¤±æ•—:', error);
      throw error; // è§¸ç™¼é‡è©¦
    }
  },
  {
    connection: redis,
    concurrency: 10, // ä¸¦è¡Œè™•ç†
  }
);

// ç›£è½äº‹ä»¶
copyTradeWorker.on('completed', (job) => {
  console.log(`Job ${job.id} completed`);
});

copyTradeWorker.on('failed', (job, err) => {
  console.error(`Job ${job?.id} failed:`, err);
});
```

#### æ•¸æ“šåº«

**PostgreSQL 16 with Prisma 5.7**

Prisma Schema ç¤ºä¾‹ï¼š
```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(uuid())
  suiAddress      String   @unique
  username        String?
  email           String?
  avatarUrl       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // é—œè¯
  traderProfile   TraderProfile?
  copyRelationsAsLeader   CopyRelation[] @relation("Leader")
  copyRelationsAsFollower CopyRelation[] @relation("Follower")
  trades          Trade[]
}

model TraderProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])

  totalFollowers  Int      @default(0)
  totalPnl        Decimal  @default(0) @db.Decimal(20, 8)
  winRate         Decimal  @default(0) @db.Decimal(5, 4)
  maxDrawdown     Decimal  @default(0) @db.Decimal(5, 4)
  totalTrades     Int      @default(0)
  winningTrades   Int      @default(0)

  isVerified      Boolean  @default(false)
  tier            Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([totalPnl(sort: Desc)])
  @@index([winRate(sort: Desc)])
}

model CopyRelation {
  id                String   @id @default(uuid())

  leaderId          String
  leader            User     @relation("Leader", fields: [leaderId], references: [id])

  followerId        String
  follower          User     @relation("Follower", fields: [followerId], references: [id])

  copyRatio         Int      // Basis points (0-10000)
  maxPositionSize   Decimal  @db.Decimal(20, 8)
  feeRate           Int      // Basis points

  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // é—œè¯
  executions        CopyTradeExecution[]

  @@unique([leaderId, followerId])
  @@index([leaderId, isActive])
  @@index([followerId, isActive])
}

model CopyTradeExecution {
  id                String   @id @default(uuid())

  relationId        String
  relation          CopyRelation @relation(fields: [relationId], references: [id])

  leaderAddress     String
  followerAddress   String

  originalQuantity  Decimal  @db.Decimal(20, 8)
  copiedQuantity    Decimal  @db.Decimal(20, 8)
  copyRatio         Int
  feePaid           Decimal  @db.Decimal(20, 8)

  txDigest          String   @unique
  timestamp         DateTime @default(now())

  @@index([leaderAddress, timestamp(sort: Desc)])
  @@index([followerAddress, timestamp(sort: Desc)])
}

model Trade {
  id              String   @id @default(uuid())

  userId          String
  user            User     @relation(fields: [userId], references: [id])

  marginManagerId String
  poolId          String

  orderType       String   // MARKET | LIMIT
  side            String   // BUY | SELL
  price           Decimal? @db.Decimal(20, 8)
  quantity        Decimal  @db.Decimal(20, 8)
  filledQuantity  Decimal  @db.Decimal(20, 8)

  status          String   // OPEN | FILLED | CANCELLED
  pnl             Decimal? @db.Decimal(20, 8)
  fee             Decimal  @db.Decimal(20, 8)

  isCopyTrade     Boolean  @default(false)
  copiedFrom      String?

  txDigest        String   @unique
  createdAt       DateTime @default(now())
  filledAt        DateTime?

  @@index([userId, createdAt(sort: Desc)])
  @@index([poolId, createdAt(sort: Desc)])
}
```

#### å¿«å–ç­–ç•¥

**Redis 7.2**

ä½¿ç”¨å ´æ™¯ï¼š
```typescript
// lib/cache.ts
import { redis } from './redis';

export class CacheService {
  // æ’è¡Œæ¦œå¿«å–ï¼ˆ30 ç§’ TTLï¼‰
  async getLeaderboard(key: string) {
    const cached = await redis.get(`leaderboard:${key}`);
    if (cached) return JSON.parse(cached);
    return null;
  }

  async setLeaderboard(key: string, data: any) {
    await redis.setex(
      `leaderboard:${key}`,
      30, // 30 ç§’
      JSON.stringify(data)
    );
  }

  // å¯¦æ™‚åƒ¹æ ¼å¿«å–ï¼ˆ5 ç§’ TTLï¼‰
  async getPrice(poolId: string) {
    const cached = await redis.get(`price:${poolId}`);
    if (cached) return parseFloat(cached);
    return null;
  }

  async setPrice(poolId: string, price: number) {
    await redis.setex(`price:${poolId}`, 5, price.toString());
  }

  // ç”¨æˆ¶æœƒè©±ï¼ˆ1 å°æ™‚ TTLï¼‰
  async getSession(sessionId: string) {
    const cached = await redis.get(`session:${sessionId}`);
    if (cached) return JSON.parse(cached);
    return null;
  }

  async setSession(sessionId: string, data: any) {
    await redis.setex(
      `session:${sessionId}`,
      3600,
      JSON.stringify(data)
    );
  }
}
```

---

## æ•¸æ“šæµè¨­è¨ˆ

### 1. ç”¨æˆ¶äº¤æ˜“æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant B as Backend
    participant S as Sui Node
    participant D as DeepBook

    U->>F: å¡«å¯«äº¤æ˜“è¡¨å–®
    F->>F: æœ¬åœ°é©—è­‰
    F->>B: GET /api/risk/estimate
    B->>S: æŸ¥è©¢ Margin Manager
    S-->>B: è¿”å›ç•¶å‰ç‹€æ…‹
    B->>B: è¨ˆç®—é¢¨éšªæŒ‡æ¨™
    B-->>F: è¿”å›é ä¼°é¢¨éšª
    F->>U: é¡¯ç¤ºç¢ºèªå°è©±æ¡†

    U->>F: ç¢ºèªäº¤æ˜“
    F->>S: ç°½ç½²ä¸¦æäº¤ PTB
    S->>D: åŸ·è¡Œä¿è­‰é‡‘ä¸‹å–®
    D-->>S: è¿”å›åŸ·è¡Œçµæœ
    S-->>F: è¿”å›äº¤æ˜“æ†‘è­‰

    F->>B: POST /api/trades
    B->>B: è¨˜éŒ„äº¤æ˜“
    B-->>F: ç¢ºèª
    F->>U: é¡¯ç¤ºæˆåŠŸ
```

### 2. è·Ÿå–®åŸ·è¡Œæµç¨‹ï¼ˆå„ªåŒ–ç‰ˆï¼‰

```mermaid
sequenceDiagram
    participant L as Leader
    participant S as Sui Node
    participant E as Event Indexer
    participant Q as Task Queue
    participant W as Worker
    participant F1 as Follower1
    participant F2 as Follower2
    participant N as Notification

    L->>S: åŸ·è¡Œäº¤æ˜“
    S->>S: ç™¼å‡º LeaderTradeSignal
    S->>E: WebSocket æ¨é€äº‹ä»¶

    E->>E: æŸ¥è©¢æ´»èº Followers
    E->>Q: æ‰¹é‡å‰µå»ºä»»å‹™

    par ä¸¦è¡Œè™•ç†
        Q->>W: Follower1 ä»»å‹™
        W->>S: æŸ¥è©¢é¢¨éšªæ¯”ç‡
        S-->>W: é¢¨éšª OK
        W->>S: åŸ·è¡Œè·Ÿå–®äº¤æ˜“
        S-->>W: æˆåŠŸ
        W->>N: ç™¼é€é€šçŸ¥
        N->>F1: æ¨é€æˆåŠŸæ¶ˆæ¯
    and
        Q->>W: Follower2 ä»»å‹™
        W->>S: æŸ¥è©¢é¢¨éšªæ¯”ç‡
        S-->>W: é¢¨éšªéé«˜
        W->>N: ç™¼é€é€šçŸ¥
        N->>F2: æ¨é€è·³éæ¶ˆæ¯
    end
```

### 3. æ’è¡Œæ¦œæ›´æ–°æµç¨‹

```mermaid
sequenceDiagram
    participant C as Cron Job
    participant DB as Database
    participant R as Redis
    participant API as API Server
    participant U as User

    C->>C: æ¯ 5 åˆ†é˜è§¸ç™¼
    C->>DB: æŸ¥è©¢æ‰€æœ‰äº¤æ˜“è€…

    loop æ¯å€‹äº¤æ˜“è€…
        C->>DB: è¨ˆç®—ç¸¾æ•ˆæŒ‡æ¨™
        C->>DB: æ›´æ–° TraderProfile
    end

    C->>DB: æŒ‰ PnL æ’åº
    C->>R: æ›´æ–°æ’è¡Œæ¦œå¿«å–

    U->>API: GET /api/leaderboard
    API->>R: æŸ¥è©¢å¿«å–
    R-->>API: è¿”å›æ•¸æ“š
    API-->>U: è¿”å›æ’è¡Œæ¦œ
```

### 4. é¢¨éšªç›£æ§æµç¨‹

```mermaid
sequenceDiagram
    participant K as Keeper (æ¯30ç§’)
    participant DB as Database
    participant S as Sui Node
    participant RE as Risk Engine
    participant N as Notification
    participant U as User

    loop æ¯ 30 ç§’
        K->>DB: ç²å–æ´»èºå€‰ä½åˆ—è¡¨

        loop æ¯å€‹å€‰ä½
            K->>S: æŸ¥è©¢ Margin Manager
            S-->>K: è¿”å›ç‹€æ…‹
            K->>RE: è¨ˆç®—é¢¨éšªè©•åˆ†

            alt å¥åº·åº¦ < 30
                K->>N: è§¸ç™¼ç·Šæ€¥è­¦å ±
                N->>U: æ¨é€é€šçŸ¥
                K->>DB: è¨˜éŒ„é¢¨éšªäº‹ä»¶
            else å¥åº·åº¦ 30-50
                K->>N: è§¸ç™¼è­¦å‘Š
                N->>U: æ¨é€æé†’
            end
        end
    end
```

---

## æ¨¡çµ„åŠƒåˆ†

### å‰ç«¯æ¨¡çµ„

```
src/
â”œâ”€â”€ components/           # UI çµ„ä»¶
â”‚   â”œâ”€â”€ trading/
â”‚   â”‚   â”œâ”€â”€ TradingPanel/
â”‚   â”‚   â”œâ”€â”€ OrderForm/
â”‚   â”‚   â”œâ”€â”€ PositionList/
â”‚   â”‚   â””â”€â”€ MarketDepth/
â”‚   â”œâ”€â”€ copyTrade/
â”‚   â”‚   â”œâ”€â”€ LeaderCard/
â”‚   â”‚   â”œâ”€â”€ CopyModal/
â”‚   â”‚   â””â”€â”€ FollowerList/
â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”‚   â”œâ”€â”€ LeaderboardTable/
â”‚   â”‚   â”œâ”€â”€ TraderProfile/
â”‚   â”‚   â””â”€â”€ PerformanceChart/
â”‚   â”œâ”€â”€ risk/
â”‚   â”‚   â”œâ”€â”€ RiskDashboard/
â”‚   â”‚   â”œâ”€â”€ HealthScore/
â”‚   â”‚   â””â”€â”€ AlertList/
â”‚   â””â”€â”€ common/
â”‚       â”œâ”€â”€ Header/
â”‚       â”œâ”€â”€ Sidebar/
â”‚       â””â”€â”€ Modal/
â”œâ”€â”€ hooks/                # è‡ªå®šç¾© Hooks
â”‚   â”œâ”€â”€ useWallet.ts
â”‚   â”œâ”€â”€ useTradingPanel.ts
â”‚   â”œâ”€â”€ useLeaderboard.ts
â”‚   â””â”€â”€ useRiskMonitor.ts
â”œâ”€â”€ services/             # API æœå‹™
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ suiClient.ts
â”‚   â””â”€â”€ riskEngine.ts
â”œâ”€â”€ store/                # å…¨å±€ç‹€æ…‹
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ userSlice.ts
â”‚   â””â”€â”€ uiSlice.ts
â”œâ”€â”€ types/                # TypeScript é¡å‹
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•¸
â””â”€â”€ pages/                # é é¢çµ„ä»¶
    â”œâ”€â”€ Dashboard/
    â”œâ”€â”€ Leaderboard/
    â”œâ”€â”€ Profile/
    â””â”€â”€ Settings/
```

### å¾Œç«¯æ¨¡çµ„

```
src/
â”œâ”€â”€ api/                  # REST API
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ leaderboard.ts
â”‚   â”‚   â”œâ”€â”€ traders.ts
â”‚   â”‚   â”œâ”€â”€ copyTrades.ts
â”‚   â”‚   â””â”€â”€ risk.ts
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ auth.ts
â”‚       â”œâ”€â”€ rateLimit.ts
â”‚       â””â”€â”€ errorHandler.ts
â”œâ”€â”€ services/             # æ¥­å‹™é‚è¼¯
â”‚   â”œâ”€â”€ copyTrade/
â”‚   â”‚   â”œâ”€â”€ CopyTradeExecutor.ts
â”‚   â”‚   â”œâ”€â”€ CopyTradeValidator.ts
â”‚   â”‚   â””â”€â”€ FeeCalculator.ts
â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”‚   â”œâ”€â”€ PerformanceCalculator.ts
â”‚   â”‚   â””â”€â”€ Ranker.ts
â”‚   â”œâ”€â”€ risk/
â”‚   â”‚   â”œâ”€â”€ RiskMonitor.ts
â”‚   â”‚   â”œâ”€â”€ AlertManager.ts
â”‚   â”‚   â””â”€â”€ RiskEngine.ts
â”‚   â””â”€â”€ notification/
â”‚       â””â”€â”€ NotificationService.ts
â”œâ”€â”€ workers/              # å¾Œå°ä»»å‹™
â”‚   â”œâ”€â”€ copyTradeWorker.ts
â”‚   â”œâ”€â”€ riskMonitorWorker.ts
â”‚   â””â”€â”€ leaderboardWorker.ts
â”œâ”€â”€ indexers/             # äº‹ä»¶ç›£è½
â”‚   â”œâ”€â”€ SuiEventListener.ts
â”‚   â””â”€â”€ DeepBookIndexer.ts
â””â”€â”€ lib/                  # åŸºç¤åº«
    â”œâ”€â”€ prisma.ts
    â”œâ”€â”€ redis.ts
    â”œâ”€â”€ suiClient.ts
    â””â”€â”€ logger.ts
```

---

## åŸºç¤è¨­æ–½

### éƒ¨ç½²æ¶æ§‹ï¼ˆHackathon éšæ®µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Cloudflare CDN                â”‚
â”‚         (å…¨çƒåŠ é€Ÿ + DDoS é˜²è­·)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Vercel (Frontend)              â”‚
â”‚  - React App                             â”‚
â”‚  - è‡ªå‹• HTTPS                            â”‚
â”‚  - Edge Functions                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Railway (Backend)               â”‚
â”‚  - Express API Server                    â”‚
â”‚  - BullMQ Workers                        â”‚
â”‚  - Event Indexers                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase    â”‚    â”‚   Redis Cloud    â”‚
â”‚ (PostgreSQL) â”‚    â”‚  (Upstash)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç’°å¢ƒé…ç½®

**.env.example**
```bash
# Sui Network
SUI_NETWORK=testnet
SUI_RPC_URL=https://fullnode.testnet.sui.io:443
MARGIN_MASTER_PACKAGE_ID=0x...
DEEPBOOK_PACKAGE_ID=0x...

# Database
DATABASE_URL=postgresql://user:password@host:5432/marginmaster
REDIS_URL=redis://default:password@host:6379

# External Services
PYTH_PRICE_FEED_ID=0x...
SURFLUX_API_KEY=xxx
NOVU_API_KEY=xxx

# Monitoring
SENTRY_DSN=https://...
MIXPANEL_TOKEN=xxx

# App Config
FRONTEND_URL=https://marginmaster.app
BACKEND_URL=https://api.marginmaster.app
```

---

## å®‰å…¨æ€§è¨­è¨ˆ

### 1. æ™ºèƒ½åˆç´„å®‰å…¨

**æ¬Šé™æ§åˆ¶**ï¼š
```move
// ç¤ºä¾‹ï¼šåªå…è¨± follower åŸ·è¡Œè·Ÿå–®
public entry fun execute_copy_trade(
    relation: &CopyTradeRelation,
    ctx: &mut TxContext
) {
    assert!(
        tx_context::sender(ctx) == relation.follower,
        E_UNAUTHORIZED
    );
    // ...
}
```

**ç·Šæ€¥æš«åœ**ï¼š
```move
struct EmergencyPause has key {
    id: UID,
    is_paused: bool,
    admin: address,
}

public entry fun pause_system(
    pause: &mut EmergencyPause,
    ctx: &mut TxContext
) {
    assert!(tx_context::sender(ctx) == pause.admin, E_UNAUTHORIZED);
    pause.is_paused = true;
}
```

### 2. API å®‰å…¨

**é€Ÿç‡é™åˆ¶**ï¼š
```typescript
import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 åˆ†é˜
  max: 100, // æœ€å¤š 100 å€‹è«‹æ±‚
  message: 'è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦',
});

app.use('/api/', limiter);
```

**è¼¸å…¥é©—è­‰**ï¼š
```typescript
import { z } from 'zod';

const copyTradeSchema = z.object({
  leaderAddress: z.string().regex(/^0x[a-fA-F0-9]{64}$/),
  copyRatio: z.number().min(1).max(10000),
  maxPositionSize: z.number().positive(),
});
```

### 3. å‰ç«¯å®‰å…¨

**XSS é˜²è­·**ï¼š
- ä½¿ç”¨ React è‡ªå‹•è½‰ç¾©
- DOMPurify æ¸…ç†ç”¨æˆ¶è¼¸å…¥

**CSRF é˜²è­·**ï¼š
- SameSite Cookie
- CORS ç™½åå–®

---

## æ€§èƒ½å„ªåŒ–

### 1. å‰ç«¯å„ªåŒ–

**ä»£ç¢¼åˆ†å‰²**ï¼š
```typescript
// è·¯ç”±æ‡¶åŠ è¼‰
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Leaderboard = lazy(() => import('./pages/Leaderboard'));
```

**è™›æ“¬åˆ—è¡¨**ï¼š
```typescript
import { FixedSizeList } from 'react-window';

function LeaderboardTable({ items }) {
  return (
    <FixedSizeList
      height={600}
      itemCount={items.length}
      itemSize={60}
    >
      {({ index, style }) => (
        <div style={style}>{items[index]}</div>
      )}
    </FixedSizeList>
  );
}
```

### 2. å¾Œç«¯å„ªåŒ–

**æ•¸æ“šåº«ç´¢å¼•**ï¼š
```prisma
model Trade {
  // ...
  @@index([userId, createdAt(sort: Desc)])
  @@index([poolId, createdAt(sort: Desc)])
}
```

**Redis å¿«å–**ï¼š
- æ’è¡Œæ¦œï¼š30 ç§’ TTL
- åƒ¹æ ¼æ•¸æ“šï¼š5 ç§’ TTL
- ç”¨æˆ¶æœƒè©±ï¼š1 å°æ™‚ TTL

---

## ç›£æ§èˆ‡æ—¥èªŒ

### æ‡‰ç”¨ç›£æ§

**Sentry**ï¼š
```typescript
import * as Sentry from '@sentry/node';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
});
```

**æ—¥èªŒ**ï¼š
```typescript
import pino from 'pino';

export const logger = pino({
  level: process.env.LOG_LEVEL || 'info',
  transport: {
    target: 'pino-pretty',
    options: {
      colorize: true,
    },
  },
});
```

---

**ä¸‹ä¸€æ­¥é–±è®€**ï¼š
- [æ™ºèƒ½åˆç´„è¨­è¨ˆ](./MarginMaster_Smart_Contracts.md)
- [é–‹ç™¼è¨ˆåŠƒ](./MarginMaster_Development_Plan.md)
