# MarginMaster - 7 å¤©é–‹ç™¼è¨ˆåŠƒ

> **ç‰ˆæœ¬:** 2.0
> **æ—¥æœŸ:** 2026-02-02
> **ç‹€æ…‹:** Ready for Execution
> **ç›®æ¨™:** Hackathon MVP

---

## ğŸ“‹ ç›®éŒ„

1. [ç¸½é«”è¦åŠƒ](#ç¸½é«”è¦åŠƒ)
2. [Day 1-2: åŸºç¤è¨­æ–½](#day-1-2-åŸºç¤è¨­æ–½)
3. [Day 3-4: æ ¸å¿ƒåŠŸèƒ½](#day-3-4-æ ¸å¿ƒåŠŸèƒ½)
4. [Day 5-6: ç¤¾äº¤èˆ‡æ•¸æ“š](#day-5-6-ç¤¾äº¤èˆ‡æ•¸æ“š)
5. [Day 7: å„ªåŒ–èˆ‡æ¼”ç¤º](#day-7-å„ªåŒ–èˆ‡æ¼”ç¤º)
6. [æ¸¬è©¦ç­–ç•¥](#æ¸¬è©¦ç­–ç•¥)
7. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
8. [é¢¨éšªç®¡ç†](#é¢¨éšªç®¡ç†)

---

## ç¸½é«”è¦åŠƒ

### Hackathon ç›®æ¨™

**å¿…é ˆå®Œæˆï¼ˆMVPï¼‰**ï¼š
- âœ… å®Œæ•´çš„ä¿è­‰é‡‘äº¤æ˜“ç•Œé¢
- âœ… å¯é‹ä½œçš„ä¸€éµè·Ÿå–®ç³»çµ±
- âœ… Top 10 äº¤æ˜“è€…æ’è¡Œæ¦œ
- âœ… å¯¦æ™‚é¢¨éšªå„€è¡¨æ¿
- âœ… å®Œæ•´çš„ Demo å½±ç‰‡ï¼ˆ3-5 åˆ†é˜ï¼‰

**å¯é¸åŠŸèƒ½ï¼ˆåŠ åˆ†é …ï¼‰**ï¼š
- ğŸ¯ æ¨¡æ“¬äº¤æ˜“æ¨¡å¼
- ğŸ¯ äº¤æ˜“è€…èªè­‰ç³»çµ±
- ğŸ¯ é€šçŸ¥æ¨é€ç³»çµ±
- ğŸ¯ ç§»å‹•ç«¯éŸ¿æ‡‰å¼è¨­è¨ˆ

### åœ˜éšŠåˆ†å·¥å»ºè­°

| è§’è‰² | ä¸»è¦è·è²¬ | Day 1-2 | Day 3-4 | Day 5-6 | Day 7 |
|------|---------|---------|---------|---------|-------|
| **å…¨æ£§é–‹ç™¼è€…** | å‰å¾Œç«¯æ•´åˆ | é …ç›®æ­å»º | äº¤æ˜“ç•Œé¢ | æ’è¡Œæ¦œ | å„ªåŒ– |
| **æ™ºèƒ½åˆç´„é–‹ç™¼** | Move åˆç´„ | åˆç´„é–‹ç™¼ | æ¸¬è©¦éƒ¨ç½² | é›†æˆ | å¯©è¨ˆ |
| **UI/UX è¨­è¨ˆå¸«** | ç•Œé¢è¨­è¨ˆ | è¨­è¨ˆç¨¿ | çµ„ä»¶å¯¦ç¾ | å„ªåŒ– | Demo |
| **ç”¢å“ç¶“ç†** | éœ€æ±‚èˆ‡æ¸¬è©¦ | éœ€æ±‚ç¢ºèª | åŠŸèƒ½æ¸¬è©¦ | ç”¨æˆ¶æ¸¬è©¦ | Pitch |

**å–®äººåœ˜éšŠå»ºè­°**ï¼šå°ˆæ³¨æ–¼æ ¸å¿ƒåŠŸèƒ½ï¼Œä½¿ç”¨ç¾æœ‰ UI åº«ï¼Œæ¸›å°‘è¨­è¨ˆæ™‚é–“ã€‚

### é–‹ç™¼é‡Œç¨‹ç¢‘

```
Day 0 â”€â”€â”€â”€â”€â”€â–º Day 2 â”€â”€â”€â”€â”€â”€â–º Day 4 â”€â”€â”€â”€â”€â”€â–º Day 6 â”€â”€â”€â”€â”€â”€â–º Day 7
   â”‚             â”‚             â”‚             â”‚             â”‚
å•Ÿå‹•æœƒè­°      åŸºç¤å®Œæˆ      æ ¸å¿ƒåŠŸèƒ½      åŠŸèƒ½å®Œæ•´      Demo å°±ç·’
   â”‚             â”‚             â”‚             â”‚             â”‚
   â””â”€ ç’°å¢ƒé…ç½®   â””â”€ éŒ¢åŒ…é€£æ¥   â””â”€ è·Ÿå–®å¯ç”¨   â””â”€ æ’è¡Œæ¦œä¸Šç·š â””â”€ å½±ç‰‡éŒ„è£½
```

---

## Day 1-2: åŸºç¤è¨­æ–½

### Day 1 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 1.1: é …ç›®åˆå§‹åŒ– â±ï¸ 1h

**å‰ç«¯åˆå§‹åŒ–**ï¼š
```bash
# å‰µå»º React é …ç›®
npm create vite@latest marginmaster-frontend -- --template react-ts
cd marginmaster-frontend

# å®‰è£ä¾è³´
npm install @mysten/sui.js @mysten/dapp-kit
npm install @tanstack/react-query zustand
npm install react-router-dom react-hook-form zod
npm install recharts lightweight-charts
npm install bignumber.js date-fns
npm install react-hot-toast

# é–‹ç™¼å·¥å…·
npm install -D @types/node
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

**å¾Œç«¯åˆå§‹åŒ–**ï¼š
```bash
# å‰µå»º Node.js é …ç›®
mkdir marginmaster-backend
cd marginmaster-backend
npm init -y

# å®‰è£ä¾è³´
npm install express cors helmet compression
npm install @mysten/sui.js
npm install @prisma/client prisma
npm install bullmq ioredis
npm install @novu/node
npm install pino pino-pretty
npm install dotenv zod

# é–‹ç™¼å·¥å…·
npm install -D typescript @types/node @types/express
npm install -D tsx nodemon
npx tsc --init
```

**æ™ºèƒ½åˆç´„åˆå§‹åŒ–**ï¼š
```bash
# å‰µå»º Move é …ç›®
sui move new margin_master
cd margin_master

# å‰µå»ºæ¨¡çµ„æ–‡ä»¶
touch sources/copy_trade.move
touch sources/trader_profile.move
touch sources/fee_manager.move
touch sources/risk_checker.move
touch sources/emergency_pause.move
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] ä¸‰å€‹é …ç›®éƒ½èƒ½æˆåŠŸå•Ÿå‹•
- [ ] ä¾è³´å®‰è£ç„¡éŒ¯èª¤
- [ ] Git å€‰åº«åˆå§‹åŒ–å®Œæˆ

---

#### ä»»å‹™ 1.2: ç’°å¢ƒé…ç½® â±ï¸ 1h

**é…ç½®æ–‡ä»¶å‰µå»º**ï¼š

```bash
# Frontend .env
VITE_SUI_NETWORK=testnet
VITE_SUI_RPC_URL=https://fullnode.testnet.sui.io:443
VITE_DEEPBOOK_PACKAGE_ID=0xdee9...
VITE_MARGIN_MASTER_PACKAGE_ID=
VITE_BACKEND_URL=http://localhost:3001

# Backend .env
NODE_ENV=development
PORT=3001

# Sui Network
SUI_NETWORK=testnet
SUI_RPC_URL=https://fullnode.testnet.sui.io:443
MARGIN_MASTER_PACKAGE_ID=

# Database
DATABASE_URL=postgresql://localhost:5432/marginmaster
REDIS_URL=redis://localhost:6379

# External Services
PYTH_PRICE_FEED_ID=
NOVU_API_KEY=

# Frontend
FRONTEND_URL=http://localhost:5173
```

**æ•¸æ“šåº«è¨­ç½®**ï¼š
```bash
# ä½¿ç”¨ Docker å¿«é€Ÿå•Ÿå‹•
docker-compose up -d

# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: marginmaster
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7.2
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] ç’°å¢ƒè®Šæ•¸é…ç½®å®Œæˆ
- [ ] æ•¸æ“šåº«é€£æ¥æˆåŠŸ
- [ ] Redis é€£æ¥æˆåŠŸ

---

### Day 1 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 1.3: éŒ¢åŒ…é›†æˆ â±ï¸ 2h

**å¯¦ç¾ SuiClientProvider**ï¼š

```typescript
// frontend/src/App.tsx
import { SuiClientProvider, WalletProvider } from '@mysten/dapp-kit';
import { getFullnodeUrl } from '@mysten/sui.js/client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import '@mysten/dapp-kit/dist/index.css';

const queryClient = new QueryClient();

const networks = {
  devnet: { url: getFullnodeUrl('devnet') },
  testnet: { url: getFullnodeUrl('testnet') },
  mainnet: { url: getFullnodeUrl('mainnet') },
};

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <SuiClientProvider networks={networks} defaultNetwork="testnet">
        <WalletProvider autoConnect>
          <Router />
        </WalletProvider>
      </SuiClientProvider>
    </QueryClientProvider>
  );
}

export default App;
```

**å¯¦ç¾éŒ¢åŒ…é€£æ¥çµ„ä»¶**ï¼š

```typescript
// frontend/src/components/ConnectWallet.tsx
import { ConnectButton, useCurrentAccount } from '@mysten/dapp-kit';

export function ConnectWallet() {
  const account = useCurrentAccount();

  return (
    <div className="wallet-section">
      {account ? (
        <div className="wallet-info">
          <span className="address">
            {account.address.slice(0, 6)}...{account.address.slice(-4)}
          </span>
          <ConnectButton />
        </div>
      ) : (
        <ConnectButton />
      )}
    </div>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] éŒ¢åŒ…å¯ä»¥æˆåŠŸé€£æ¥
- [ ] é¡¯ç¤ºéŒ¢åŒ…åœ°å€
- [ ] å¯ä»¥æ–·é–‹é€£æ¥

---

#### ä»»å‹™ 1.4: æ™ºèƒ½åˆç´„éª¨æ¶ â±ï¸ 3h

**å¯¦ç¾æ ¸å¿ƒæ¨¡çµ„**ï¼ˆå¾è¨­è¨ˆæ–‡æª”è¤‡è£½ä¸¦èª¿æ•´ï¼‰ï¼š

```bash
# å°‡ MarginMaster_Smart_Contracts.md ä¸­çš„ä»£ç¢¼è¤‡è£½åˆ°å°æ‡‰æ–‡ä»¶
# é‡é»å¯¦ç¾ï¼š
# 1. copy_trade.move - æ ¸å¿ƒè·Ÿå–®é‚è¼¯
# 2. trader_profile.move - äº¤æ˜“è€…æª”æ¡ˆ
# 3. emergency_pause.move - ç·Šæ€¥æš«åœ

# ç·¨è­¯æ¸¬è©¦
sui move build
sui move test
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] åˆç´„ç·¨è­¯æˆåŠŸ
- [ ] åŸºæœ¬æ¸¬è©¦é€šé
- [ ] ç„¡ Warning

---

### Day 2 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 2.1: åˆç´„éƒ¨ç½² â±ï¸ 1h

```bash
# åˆ‡æ›åˆ°æ¸¬è©¦ç¶²
sui client switch --env testnet

# æª¢æŸ¥ gas
sui client gas

# éƒ¨ç½²åˆç´„
sui client publish --gas-budget 500000000

# è¨˜éŒ„é—œéµå°è±¡ ID
# PackageID: 0x...
# CopyTradeRegistry: 0x...
# FeeConfig: 0x...
# EmergencyPause: 0x...
# AdminCap: 0x...
```

**æ›´æ–°ç’°å¢ƒè®Šæ•¸**ï¼š
```bash
# å°‡éƒ¨ç½²çš„ ID æ›´æ–°åˆ° .env
VITE_MARGIN_MASTER_PACKAGE_ID=0x...
COPY_TRADE_REGISTRY_ID=0x...
FEE_CONFIG_ID=0x...
EMERGENCY_PAUSE_ID=0x...
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] åˆç´„éƒ¨ç½²æˆåŠŸ
- [ ] æ‰€æœ‰å°è±¡ ID å·²è¨˜éŒ„
- [ ] ç’°å¢ƒè®Šæ•¸å·²æ›´æ–°

---

#### ä»»å‹™ 2.2: æ•¸æ“šåº« Schema â±ï¸ 2h

**Prisma Schema**ï¼š

```prisma
// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(uuid())
  suiAddress      String   @unique
  username        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  traderProfile   TraderProfile?
  copyRelationsAsLeader   CopyRelation[] @relation("Leader")
  copyRelationsAsFollower CopyRelation[] @relation("Follower")
  trades          Trade[]
}

model TraderProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])

  totalFollowers  Int      @default(0)
  totalPnl        Decimal  @default(0) @db.Decimal(20, 8)
  winRate         Decimal  @default(0) @db.Decimal(5, 4)
  totalTrades     Int      @default(0)

  isVerified      Boolean  @default(false)
  tier            Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([totalPnl(sort: Desc)])
  @@index([winRate(sort: Desc)])
}

model CopyRelation {
  id                String   @id @default(uuid())

  leaderId          String
  leader            User     @relation("Leader", fields: [leaderId], references: [id])

  followerId        String
  follower          User     @relation("Follower", fields: [followerId], references: [id])

  copyRatio         Int
  maxPositionSize   Decimal  @db.Decimal(20, 8)
  feeRate           Int

  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  executions        CopyTradeExecution[]

  @@unique([leaderId, followerId])
  @@index([leaderId, isActive])
}

model CopyTradeExecution {
  id                String   @id @default(uuid())

  relationId        String
  relation          CopyRelation @relation(fields: [relationId], references: [id])

  leaderAddress     String
  followerAddress   String

  originalQuantity  Decimal  @db.Decimal(20, 8)
  copiedQuantity    Decimal  @db.Decimal(20, 8)
  feePaid           Decimal  @db.Decimal(20, 8)

  txDigest          String   @unique
  timestamp         DateTime @default(now())

  @@index([leaderAddress, timestamp(sort: Desc)])
}

model Trade {
  id              String   @id @default(uuid())

  userId          String
  user            User     @relation(fields: [userId], references: [id])

  poolId          String
  side            String
  quantity        Decimal  @db.Decimal(20, 8)
  price           Decimal? @db.Decimal(20, 8)

  pnl             Decimal? @db.Decimal(20, 8)
  txDigest        String   @unique
  createdAt       DateTime @default(now())

  @@index([userId, createdAt(sort: Desc)])
}
```

**åŸ·è¡Œé·ç§»**ï¼š
```bash
npx prisma migrate dev --name init
npx prisma generate
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] Schema å‰µå»ºæˆåŠŸ
- [ ] Prisma Client ç”Ÿæˆ
- [ ] å¯ä»¥æŸ¥è©¢æ•¸æ“šåº«

---

#### ä»»å‹™ 2.3: åŸºç¤ API æœå‹™å™¨ â±ï¸ 1h

```typescript
// backend/src/index.ts
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import { config } from './config';
import { logger } from './lib/logger';

const app = express();

app.use(helmet());
app.use(cors({ origin: config.frontendUrl }));
app.use(express.json());

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// API routes
app.use('/api/leaderboard', require('./api/routes/leaderboard'));
app.use('/api/traders', require('./api/routes/traders'));
app.use('/api/copy-trades', require('./api/routes/copyTrades'));

app.listen(config.port, () => {
  logger.info(`Server running on port ${config.port}`);
});
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] API æœå‹™å™¨å•Ÿå‹•æˆåŠŸ
- [ ] Health check ç«¯é»å¯è¨ªå•
- [ ] CORS é…ç½®æ­£ç¢º

---

### Day 2 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 2.4: äº‹ä»¶ç›£è½å™¨åŸºç¤ â±ï¸ 3h

```typescript
// backend/src/indexers/suiEventListener.ts
import { SuiClient, SuiEvent } from '@mysten/sui.js/client';
import { config } from '../config';
import { logger } from '../lib/logger';

export class SuiEventListener {
  private suiClient: SuiClient;

  constructor() {
    this.suiClient = new SuiClient({ url: config.suiRpcUrl });
  }

  async startListening() {
    // ç›£è½ LeaderTradeSignal äº‹ä»¶
    const unsubscribe = await this.suiClient.subscribeEvent({
      filter: {
        MoveEventType: `${config.packageId}::copy_trade::LeaderTradeSignal`
      },
      onMessage: (event: SuiEvent) => {
        this.handleLeaderTradeSignal(event);
      }
    });

    logger.info('Event listener started');
    return unsubscribe;
  }

  private async handleLeaderTradeSignal(event: SuiEvent) {
    logger.info('Received LeaderTradeSignal', event.parsedJson);

    // TODO: Day 3-4 å¯¦ç¾è·Ÿå–®é‚è¼¯
  }
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] äº‹ä»¶ç›£è½å™¨å•Ÿå‹•æˆåŠŸ
- [ ] å¯ä»¥æ¥æ”¶æ¸¬è©¦äº‹ä»¶
- [ ] æ—¥èªŒè¨˜éŒ„æ­£å¸¸

---

#### ä»»å‹™ 2.5: å‰ç«¯åŸºç¤çµ„ä»¶ â±ï¸ 2h

**å¯¦ç¾åŸºç¤å¸ƒå±€**ï¼š

```typescript
// frontend/src/components/Layout.tsx
import { Outlet } from 'react-router-dom';
import { Header } from './Header';
import { Sidebar } from './Sidebar';

export function Layout() {
  return (
    <div className="app-layout">
      <Header />
      <div className="main-content">
        <Sidebar />
        <main className="content">
          <Outlet />
        </main>
      </div>
    </div>
  );
}
```

**è·¯ç”±é…ç½®**ï¼š

```typescript
// frontend/src/router.tsx
import { createBrowserRouter } from 'react-router-dom';
import { Layout } from './components/Layout';
import { Dashboard } from './pages/Dashboard';
import { Leaderboard } from './pages/Leaderboard';
import { Profile } from './pages/Profile';

export const router = createBrowserRouter([
  {
    path: '/',
    element: <Layout />,
    children: [
      { index: true, element: <Dashboard /> },
      { path: 'leaderboard', element: <Leaderboard /> },
      { path: 'profile/:address', element: <Profile /> },
    ],
  },
]);
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] åŸºç¤å¸ƒå±€é¡¯ç¤ºæ­£å¸¸
- [ ] è·¯ç”±å°èˆªå·¥ä½œ
- [ ] éŒ¢åŒ…æŒ‰éˆ•é›†æˆå®Œæˆ

---

### Day 2 ç¸½çµ & æª¢æŸ¥é»

**å®Œæˆæ¨™èªŒ**ï¼š
- âœ… å‰ç«¯é …ç›®å¯é‹è¡Œï¼ŒéŒ¢åŒ…å¯é€£æ¥
- âœ… å¾Œç«¯ API æœå‹™å™¨é‹è¡Œï¼Œæ•¸æ“šåº«é€£æ¥æˆåŠŸ
- âœ… æ™ºèƒ½åˆç´„å·²éƒ¨ç½²åˆ°æ¸¬è©¦ç¶²
- âœ… äº‹ä»¶ç›£è½å™¨åŸºç¤æ¡†æ¶å®Œæˆ
- âœ… Git æäº¤ä»£ç¢¼ï¼ŒTag: `v0.1-infrastructure`

**é—œéµæ–‡ä»¶çµæ§‹**ï¼š
```
marginmaster/
â”œâ”€â”€ frontend/               âœ…
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ backend/                âœ…
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ indexers/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ margin_master/          âœ…
â”‚   â”œâ”€â”€ sources/
â”‚   â”‚   â”œâ”€â”€ copy_trade.move
â”‚   â”‚   â””â”€â”€ trader_profile.move
â”‚   â””â”€â”€ Move.toml
â””â”€â”€ docker-compose.yml      âœ…
```

---

## Day 3-4: æ ¸å¿ƒåŠŸèƒ½

### Day 3 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 3.1: ä¿è­‰é‡‘äº¤æ˜“ç•Œé¢ â±ï¸ 3h

**å¯¦ç¾äº¤æ˜“é¢æ¿çµ„ä»¶**ï¼š

```typescript
// frontend/src/components/trading/TradingPanel.tsx
import { useState } from 'react';
import { useWallet } from '@/hooks/useWallet';
import { OrderForm } from './OrderForm';
import { RiskMetrics } from './RiskMetrics';

export function TradingPanel() {
  const { address, executeTransaction } = useWallet();
  const [orderType, setOrderType] = useState<'MARKET' | 'LIMIT'>('MARKET');
  const [side, setSide] = useState<'BUY' | 'SELL'>('BUY');

  return (
    <div className="trading-panel">
      <div className="panel-header">
        <h2>ä¿è­‰é‡‘äº¤æ˜“</h2>
        <div className="price-ticker">
          {/* å¯¦æ™‚åƒ¹æ ¼é¡¯ç¤º */}
        </div>
      </div>

      <div className="panel-body">
        <OrderForm
          orderType={orderType}
          side={side}
          onOrderTypeChange={setOrderType}
          onSideChange={setSide}
        />
        <RiskMetrics />
      </div>
    </div>
  );
}
```

**å¯¦ç¾è¨‚å–®è¡¨å–®**ï¼š

```typescript
// frontend/src/components/trading/OrderForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const orderSchema = z.object({
  quantity: z.number().positive(),
  price: z.number().positive().optional(),
  leverage: z.number().min(1).max(10),
});

type OrderFormData = z.infer<typeof orderSchema>;

export function OrderForm({ orderType, side, ... }) {
  const { register, handleSubmit, formState: { errors } } = useForm<OrderFormData>({
    resolver: zodResolver(orderSchema),
  });

  const onSubmit = async (data: OrderFormData) => {
    // æ§‹å»ºäº¤æ˜“
    const tx = new TransactionBlock();

    // èª¿ç”¨ DeepBook Margin
    tx.moveCall({
      target: `${DEEPBOOK_PKG}::pool_proxy::place_market_order`,
      arguments: [
        tx.object(marginManagerId),
        tx.object(poolId),
        tx.pure(data.quantity),
        tx.pure(side === 'BUY'),
      ],
    });

    // ç™¼å‡ºè·Ÿå–®ä¿¡è™Ÿ
    tx.moveCall({
      target: `${PACKAGE_ID}::copy_trade::emit_leader_trade_signal`,
      arguments: [
        tx.object(profileId),
        tx.pure(poolId),
        tx.pure(side === 'BUY'),
        tx.pure(0), // MARKET
        tx.pure(null, 'Option'),
        tx.pure(data.quantity),
        tx.pure(data.leverage),
        tx.pure([]), // tx_digest will be filled later
      ],
    });

    await executeTransaction(tx);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* è¡¨å–®å­—æ®µ */}
    </form>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] äº¤æ˜“è¡¨å–®å¯ä»¥æäº¤
- [ ] èˆ‡ DeepBook é›†æˆæˆåŠŸ
- [ ] ç™¼å‡ºè·Ÿå–®ä¿¡è™Ÿäº‹ä»¶

---

### Day 3 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 3.2: è·Ÿå–®åŸ·è¡Œé‚è¼¯ â±ï¸ 4h

**å¯¦ç¾è·Ÿå–®åŸ·è¡Œå™¨**ï¼š

```typescript
// backend/src/services/copyTrade/executor.ts
import { SuiClient } from '@mysten/sui.js/client';
import { TransactionBlock } from '@mysten/sui.js/transactions';
import { prisma } from '@/lib/prisma';

export class CopyTradeExecutor {
  constructor(private suiClient: SuiClient) {}

  async executeCopyTrade(params: {
    leaderAddress: string;
    followerAddress: string;
    tradeSignal: TradeSignal;
  }) {
    // 1. ç²å–è·Ÿå–®é—œä¿‚
    const relation = await prisma.copyRelation.findUnique({
      where: {
        leaderId_followerId: {
          leaderId: params.leaderAddress,
          followerId: params.followerAddress,
        },
      },
    });

    if (!relation || !relation.isActive) {
      return;
    }

    // 2. æª¢æŸ¥é¢¨éšªæ¯”ç‡
    const riskRatio = await this.checkRiskRatio(followerManagerId);
    if (riskRatio < 1.2) {
      logger.warn('Risk too high, skipping copy trade');
      return;
    }

    // 3. è¨ˆç®—è·Ÿå–®è¦æ¨¡
    const copiedQuantity = this.calculateCopySize(
      BigInt(params.tradeSignal.quantity),
      relation.copyRatio,
      BigInt(relation.maxPositionSize)
    );

    // 4. åŸ·è¡Œéˆä¸Šäº¤æ˜“
    const tx = new TransactionBlock();

    // ... æ§‹å»ºäº¤æ˜“

    const result = await this.suiClient.signAndExecuteTransactionBlock({
      transactionBlock: tx,
      // ... ä½¿ç”¨ follower çš„ç§é‘°ï¼ˆå¯¦éš›éœ€è¦æˆæ¬Šæ©Ÿåˆ¶ï¼‰
    });

    // 5. è¨˜éŒ„åŸ·è¡Œçµæœ
    await prisma.copyTradeExecution.create({
      data: {
        relationId: relation.id,
        leaderAddress: params.leaderAddress,
        followerAddress: params.followerAddress,
        originalQuantity: params.tradeSignal.quantity,
        copiedQuantity: copiedQuantity.toString(),
        feePaid: '0', // TODO: è¨ˆç®—è²»ç”¨
        txDigest: result.digest,
      },
    });
  }

  private calculateCopySize(
    originalQty: bigint,
    copyRatio: number,
    maxPosition: bigint
  ): bigint {
    const calculated = (originalQty * BigInt(copyRatio)) / 10000n;
    return calculated > maxPosition ? maxPosition : calculated;
  }
}
```

**æ•´åˆåˆ°äº‹ä»¶ç›£è½å™¨**ï¼š

```typescript
// backend/src/indexers/suiEventListener.ts (æ›´æ–°)
private async handleLeaderTradeSignal(event: SuiEvent) {
  const signal = event.parsedJson;

  // æŸ¥è©¢ followers
  const followers = await prisma.copyRelation.findMany({
    where: {
      leaderId: signal.leader,
      isActive: true,
    },
  });

  // åŸ·è¡Œè·Ÿå–®
  for (const relation of followers) {
    try {
      await this.executor.executeCopyTrade({
        leaderAddress: signal.leader,
        followerAddress: relation.followerId,
        tradeSignal: signal,
      });
    } catch (error) {
      logger.error('Copy trade failed', error);
    }
  }
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] å¯ä»¥æ¥æ”¶ Leader äº¤æ˜“ä¿¡è™Ÿ
- [ ] è‡ªå‹•æŸ¥è©¢ Followers
- [ ] åŸ·è¡Œè·Ÿå–®äº¤æ˜“æˆåŠŸ

---

### Day 4 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 4.1: è·Ÿå–®ç®¡ç†ç•Œé¢ â±ï¸ 3h

**å¯¦ç¾è·Ÿå–®å‰µå»ºå½ˆçª—**ï¼š

```typescript
// frontend/src/components/copyTrade/CopyModal.tsx
import { useState } from 'react';
import { useWallet } from '@/hooks/useWallet';

export function CopyModal({ leader, onClose }) {
  const { executeTransaction } = useWallet();
  const [copyRatio, setCopyRatio] = useState(50);
  const [maxPosition, setMaxPosition] = useState(1000);
  const [feeRate, setFeeRate] = useState(leader.suggestedFeeRate || 5);

  const handleCreateRelation = async () => {
    const tx = new TransactionBlock();

    tx.moveCall({
      target: `${PACKAGE_ID}::copy_trade::create_copy_relation`,
      arguments: [
        tx.object(REGISTRY_ID),
        tx.object(PAUSE_ID),
        tx.pure(leader.address),
        tx.pure(copyRatio * 100), // è½‰ç‚º basis points
        tx.pure(maxPosition),
        tx.pure(feeRate * 100),
      ],
    });

    await executeTransaction(tx);
    onClose();
  };

  return (
    <div className="modal">
      <div className="modal-content">
        <h2>è·Ÿå–®è¨­ç½®</h2>

        <div className="form-group">
          <label>è·Ÿå–®æ¯”ä¾‹: {copyRatio}%</label>
          <input
            type="range"
            min="1"
            max="100"
            value={copyRatio}
            onChange={(e) => setCopyRatio(Number(e.target.value))}
          />
        </div>

        <div className="form-group">
          <label>æœ€å¤§å–®ç­†å€‰ä½</label>
          <input
            type="number"
            value={maxPosition}
            onChange={(e) => setMaxPosition(Number(e.target.value))}
          />
        </div>

        <div className="form-group">
          <label>è²»ç‡: {feeRate}%</label>
          <span className="fee-info">
            é ä¼°æœˆè²»ç”¨: ${estimatedMonthlyFee}
          </span>
        </div>

        <div className="modal-actions">
          <button onClick={onClose}>å–æ¶ˆ</button>
          <button onClick={handleCreateRelation}>ç¢ºèªè·Ÿå–®</button>
        </div>
      </div>
    </div>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] å¯ä»¥å‰µå»ºè·Ÿå–®é—œä¿‚
- [ ] åƒæ•¸é©—è­‰æ­£ç¢º
- [ ] äº¤æ˜“æˆåŠŸåŸ·è¡Œ

---

### Day 4 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 4.2: é¢¨éšªç›£æ§ç³»çµ± â±ï¸ 3h

**å¯¦ç¾é¢¨éšªå¼•æ“**ï¼š

```typescript
// frontend/src/services/riskEngine.ts
export interface RiskMetrics {
  currentRiskRatio: number;
  liquidationPrice: number;
  marginUsed: number;
  marginAvailable: number;
  healthScore: number;
}

export class RiskEngine {
  async calculateRiskMetrics(marginManagerId: string): Promise<RiskMetrics> {
    // æŸ¥è©¢ Margin Manager ç‹€æ…‹
    const managerState = await suiClient.getObject({
      id: marginManagerId,
      options: { showContent: true },
    });

    const fields = (managerState.data?.content as any).fields;

    const baseBalance = BigInt(fields.base_balance);
    const quoteBalance = BigInt(fields.quote_balance);
    const borrowedBase = BigInt(fields.borrowed_base);
    const borrowedQuote = BigInt(fields.borrowed_quote);

    // ç²å–ç•¶å‰åƒ¹æ ¼
    const currentPrice = await this.getCurrentPrice(fields.pool_id);

    // è¨ˆç®—é¢¨éšªæŒ‡æ¨™
    const totalAssets = Number(baseBalance) * currentPrice + Number(quoteBalance);
    const totalDebt = Number(borrowedBase) * currentPrice + Number(borrowedQuote);
    const riskRatio = totalDebt === 0 ? Infinity : totalAssets / totalDebt;

    const liquidationPrice = this.calculateLiquidationPrice(
      Number(baseBalance),
      Number(quoteBalance),
      Number(borrowedBase),
      Number(borrowedQuote)
    );

    const healthScore = this.calculateHealthScore(riskRatio);

    return {
      currentRiskRatio: riskRatio,
      liquidationPrice,
      marginUsed: totalDebt,
      marginAvailable: totalAssets - totalDebt,
      healthScore,
    };
  }

  private calculateHealthScore(riskRatio: number): number {
    if (riskRatio >= 2.0) return 100;
    if (riskRatio >= 1.5) return 80;
    if (riskRatio >= 1.3) return 60;
    if (riskRatio >= 1.15) return 30;
    return 10;
  }

  private calculateLiquidationPrice(
    baseBalance: number,
    quoteBalance: number,
    borrowedBase: number,
    borrowedQuote: number
  ): number {
    const threshold = 1.1;
    const numerator = threshold * borrowedQuote - quoteBalance;
    const denominator = baseBalance - threshold * borrowedBase;

    if (denominator === 0) return Infinity;
    return numerator / denominator;
  }
}
```

**å¯¦ç¾é¢¨éšªå„€è¡¨æ¿**ï¼š

```typescript
// frontend/src/components/risk/RiskDashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { riskEngine } from '@/services/riskEngine';

export function RiskDashboard({ marginManagerId }) {
  const { data: metrics } = useQuery({
    queryKey: ['risk', marginManagerId],
    queryFn: () => riskEngine.calculateRiskMetrics(marginManagerId),
    refetchInterval: 30_000, // æ¯ 30 ç§’æ›´æ–°
  });

  if (!metrics) return <div>Loading...</div>;

  return (
    <div className="risk-dashboard">
      <div className="health-score">
        <h3>å¥åº·åº¦</h3>
        <div className={`score score-${getScoreClass(metrics.healthScore)}`}>
          {metrics.healthScore}
        </div>
      </div>

      <div className="risk-metrics">
        <div className="metric">
          <label>é¢¨éšªæ¯”ç‡</label>
          <span>{metrics.currentRiskRatio.toFixed(2)}x</span>
        </div>

        <div className="metric">
          <label>æ¸…ç®—åƒ¹æ ¼</label>
          <span>${metrics.liquidationPrice.toFixed(2)}</span>
        </div>

        <div className="metric">
          <label>å¯ç”¨ä¿è­‰é‡‘</label>
          <span>${metrics.marginAvailable.toFixed(2)}</span>
        </div>
      </div>

      {metrics.healthScore < 30 && (
        <div className="alert alert-danger">
          âš ï¸ æ‚¨çš„å€‰ä½æ¥è¿‘æ¸…ç®—ï¼å»ºè­°ç«‹å³æ¸›å€‰æˆ–å¢åŠ ä¿è­‰é‡‘ã€‚
        </div>
      )}
    </div>
  );
}

function getScoreClass(score: number): string {
  if (score >= 80) return 'good';
  if (score >= 50) return 'warning';
  return 'danger';
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] é¢¨éšªæŒ‡æ¨™è¨ˆç®—æ­£ç¢º
- [ ] å„€è¡¨æ¿å¯¦æ™‚æ›´æ–°
- [ ] è­¦å ±æ­£å¸¸è§¸ç™¼

---

#### ä»»å‹™ 4.3: æŒå€‰ç®¡ç† â±ï¸ 2h

**å¯¦ç¾æŒå€‰åˆ—è¡¨**ï¼š

```typescript
// frontend/src/components/trading/PositionList.tsx
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';

export function PositionList({ marginManagerId }) {
  const { data: positions } = useQuery({
    queryKey: ['positions', marginManagerId],
    queryFn: () => api.getPositions(marginManagerId),
    refetchInterval: 10_000,
  });

  return (
    <div className="position-list">
      <h3>ç•¶å‰æŒå€‰</h3>

      <table>
        <thead>
          <tr>
            <th>è³‡ç”¢</th>
            <th>æ–¹å‘</th>
            <th>æ•¸é‡</th>
            <th>å…¥å ´åƒ¹</th>
            <th>ç•¶å‰åƒ¹</th>
            <th>æœªå¯¦ç¾ç›ˆè™§</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {positions?.map((position) => (
            <tr key={position.id}>
              <td>{position.asset}</td>
              <td className={position.side}>{position.side}</td>
              <td>{position.quantity}</td>
              <td>${position.entryPrice}</td>
              <td>${position.currentPrice}</td>
              <td className={position.pnl > 0 ? 'profit' : 'loss'}>
                ${position.pnl.toFixed(2)}
              </td>
              <td>
                <button onClick={() => handleClose(position)}>
                  å¹³å€‰
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] æŒå€‰åˆ—è¡¨é¡¯ç¤ºæ­£ç¢º
- [ ] å¯¦æ™‚æ›´æ–°ç›ˆè™§
- [ ] å¯ä»¥åŸ·è¡Œå¹³å€‰

---

### Day 4 ç¸½çµ & æª¢æŸ¥é»

**å®Œæˆæ¨™èªŒ**ï¼š
- âœ… å®Œæ•´çš„äº¤æ˜“ç•Œé¢å¯ç”¨
- âœ… è·Ÿå–®ç³»çµ±å¯ä»¥æ­£å¸¸å·¥ä½œ
- âœ… é¢¨éšªç›£æ§å¯¦æ™‚æ›´æ–°
- âœ… Git Tag: `v0.2-core-features`

---

## Day 5-6: ç¤¾äº¤èˆ‡æ•¸æ“š

### Day 5 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 5.1: ç¸¾æ•ˆè¨ˆç®—æœå‹™ â±ï¸ 3h

**å¯¦ç¾ç¸¾æ•ˆè¨ˆç®—å™¨**ï¼š

```typescript
// backend/src/services/leaderboard/calculator.ts
import { prisma } from '@/lib/prisma';

export class PerformanceCalculator {
  async calculateTraderStats(userAddress: string) {
    // ç²å–æ‰€æœ‰äº¤æ˜“
    const trades = await prisma.trade.findMany({
      where: { userId: userAddress },
      orderBy: { createdAt: 'asc' },
    });

    const totalTrades = trades.length;
    const winningTrades = trades.filter(t => t.pnl && Number(t.pnl) > 0);
    const losingTrades = trades.filter(t => t.pnl && Number(t.pnl) < 0);

    const totalPnl = trades.reduce((sum, t) => sum + Number(t.pnl || 0), 0);
    const winRate = totalTrades > 0 ? winningTrades.length / totalTrades : 0;

    const avgProfit = winningTrades.length > 0
      ? winningTrades.reduce((sum, t) => sum + Number(t.pnl!), 0) / winningTrades.length
      : 0;

    const avgLoss = losingTrades.length > 0
      ? Math.abs(losingTrades.reduce((sum, t) => sum + Number(t.pnl!), 0) / losingTrades.length)
      : 0;

    const maxDrawdown = this.calculateMaxDrawdown(trades);
    const sharpeRatio = this.calculateSharpeRatio(trades);

    // æ›´æ–°æ•¸æ“šåº«
    await prisma.traderProfile.upsert({
      where: { userId: userAddress },
      update: {
        totalPnl,
        winRate,
        totalTrades,
        updatedAt: new Date(),
      },
      create: {
        userId: userAddress,
        totalPnl,
        winRate,
        totalTrades,
      },
    });

    return {
      totalPnl,
      winRate,
      totalTrades,
      avgProfit,
      avgLoss,
      maxDrawdown,
      sharpeRatio,
    };
  }

  private calculateMaxDrawdown(trades: any[]): number {
    let peak = 0;
    let maxDrawdown = 0;
    let cumulative = 0;

    for (const trade of trades) {
      cumulative += Number(trade.pnl || 0);
      if (cumulative > peak) peak = cumulative;
      const drawdown = peak === 0 ? 0 : (peak - cumulative) / peak;
      if (drawdown > maxDrawdown) maxDrawdown = drawdown;
    }

    return maxDrawdown;
  }

  private calculateSharpeRatio(trades: any[]): number {
    if (trades.length < 2) return 0;

    const returns = trades.map(t => Number(t.pnl || 0));
    const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
    const variance = returns.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / returns.length;
    const stdDev = Math.sqrt(variance);

    return stdDev === 0 ? 0 : mean / stdDev;
  }
}
```

**è¨­ç½®å®šæ™‚ä»»å‹™**ï¼š

```typescript
// backend/src/workers/leaderboardWorker.ts
import { CronJob } from 'cron';
import { PerformanceCalculator } from '../services/leaderboard/calculator';

const calculator = new PerformanceCalculator();

// æ¯ 5 åˆ†é˜æ›´æ–°ä¸€æ¬¡æ’è¡Œæ¦œ
export const leaderboardJob = new CronJob('*/5 * * * *', async () => {
  console.log('Updating leaderboard...');

  const traders = await prisma.user.findMany({
    where: {
      traderProfile: { isNot: null },
    },
  });

  for (const trader of traders) {
    await calculator.calculateTraderStats(trader.suiAddress);
  }

  console.log('Leaderboard updated');
});

leaderboardJob.start();
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] ç¸¾æ•ˆè¨ˆç®—æ­£ç¢º
- [ ] å®šæ™‚ä»»å‹™é‹è¡Œ
- [ ] æ•¸æ“šåº«æ›´æ–°æˆåŠŸ

---

### Day 5 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 5.2: æ’è¡Œæ¦œ API èˆ‡ç•Œé¢ â±ï¸ 4h

**å¯¦ç¾æ’è¡Œæ¦œ API**ï¼š

```typescript
// backend/src/api/routes/leaderboard.ts
import { Router } from 'express';
import { prisma } from '@/lib/prisma';
import { redis } from '@/lib/redis';

const router = Router();

router.get('/', async (req, res) => {
  const { sortBy = 'totalPnl', order = 'desc', limit = 50 } = req.query;

  // æª¢æŸ¥å¿«å–
  const cacheKey = `leaderboard:${sortBy}:${order}:${limit}`;
  const cached = await redis.get(cacheKey);

  if (cached) {
    return res.json(JSON.parse(cached));
  }

  // æŸ¥è©¢æ•¸æ“šåº«
  const traders = await prisma.traderProfile.findMany({
    include: {
      user: {
        select: {
          suiAddress: true,
          username: true,
        },
      },
    },
    orderBy: {
      [sortBy as string]: order,
    },
    take: Number(limit),
  });

  const result = traders.map((trader, index) => ({
    rank: index + 1,
    address: trader.user.suiAddress,
    username: trader.user.username,
    totalPnl: Number(trader.totalPnl),
    winRate: Number(trader.winRate) * 100,
    totalTrades: trader.totalTrades,
    totalFollowers: trader.totalFollowers,
    tier: trader.tier,
    isVerified: trader.isVerified,
  }));

  // å¿«å– 30 ç§’
  await redis.setex(cacheKey, 30, JSON.stringify(result));

  res.json(result);
});

export default router;
```

**å¯¦ç¾æ’è¡Œæ¦œç•Œé¢**ï¼š

```typescript
// frontend/src/pages/Leaderboard.tsx
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';
import { CopyModal } from '@/components/copyTrade/CopyModal';
import { useState } from 'react';

export function Leaderboard() {
  const [selectedLeader, setSelectedLeader] = useState(null);
  const [sortBy, setSortBy] = useState('totalPnl');

  const { data: leaders, isLoading } = useQuery({
    queryKey: ['leaderboard', sortBy],
    queryFn: () => api.getLeaderboard({ sortBy }),
    refetchInterval: 60_000, // æ¯åˆ†é˜åˆ·æ–°
  });

  if (isLoading) return <div>Loading...</div>;

  return (
    <div className="leaderboard-page">
      <h1>äº¤æ˜“è€…æ’è¡Œæ¦œ</h1>

      <div className="sort-controls">
        <button onClick={() => setSortBy('totalPnl')}>æŒ‰ç›ˆè™§æ’åº</button>
        <button onClick={() => setSortBy('winRate')}>æŒ‰å‹ç‡æ’åº</button>
        <button onClick={() => setSortBy('totalFollowers')}>æŒ‰è·Ÿéš¨è€…æ’åº</button>
      </div>

      <table className="leaderboard-table">
        <thead>
          <tr>
            <th>æ’å</th>
            <th>äº¤æ˜“è€…</th>
            <th>30å¤©ç›ˆè™§</th>
            <th>å‹ç‡</th>
            <th>ç¸½äº¤æ˜“</th>
            <th>è·Ÿéš¨è€…</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {leaders?.map((leader) => (
            <tr key={leader.address}>
              <td className="rank">#{leader.rank}</td>
              <td>
                <div className="trader-info">
                  {leader.isVerified && <span className="badge-verified">âœ“</span>}
                  <span className="address">
                    {leader.username || `${leader.address.slice(0, 6)}...`}
                  </span>
                  {leader.tier > 0 && (
                    <span className={`tier tier-${leader.tier}`}>
                      {getTierName(leader.tier)}
                    </span>
                  )}
                </div>
              </td>
              <td className={leader.totalPnl > 0 ? 'profit' : 'loss'}>
                ${leader.totalPnl.toFixed(2)}
              </td>
              <td>{leader.winRate.toFixed(1)}%</td>
              <td>{leader.totalTrades}</td>
              <td>{leader.totalFollowers}</td>
              <td>
                <button onClick={() => setSelectedLeader(leader)}>
                  è·Ÿå–®
                </button>
                <button onClick={() => navigate(`/profile/${leader.address}`)}>
                  æŸ¥çœ‹
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {selectedLeader && (
        <CopyModal
          leader={selectedLeader}
          onClose={() => setSelectedLeader(null)}
        />
      )}
    </div>
  );
}

function getTierName(tier: number): string {
  const tiers = ['', 'Bronze', 'Silver', 'Gold', 'Platinum'];
  return tiers[tier] || '';
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] æ’è¡Œæ¦œ API è¿”å›æ­£ç¢º
- [ ] æ’è¡Œæ¦œç•Œé¢é¡¯ç¤ºæ­£å¸¸
- [ ] æ’åºåŠŸèƒ½å·¥ä½œ
- [ ] å¿«å–ç”Ÿæ•ˆ

---

### Day 6 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 6.1: äº¤æ˜“è€…æª”æ¡ˆé  â±ï¸ 3h

**å¯¦ç¾æª”æ¡ˆé  API**ï¼š

```typescript
// backend/src/api/routes/traders.ts
router.get('/:address/stats', async (req, res) => {
  const { address } = req.params;

  const profile = await prisma.traderProfile.findFirst({
    where: {
      user: { suiAddress: address },
    },
    include: {
      user: true,
    },
  });

  if (!profile) {
    return res.status(404).json({ error: 'Trader not found' });
  }

  // ç²å–æœ€è¿‘äº¤æ˜“
  const recentTrades = await prisma.trade.findMany({
    where: { userId: profile.userId },
    orderBy: { createdAt: 'desc' },
    take: 20,
  });

  // ç²å– Followers
  const followers = await prisma.copyRelation.findMany({
    where: {
      leaderId: profile.userId,
      isActive: true,
    },
    include: {
      follower: {
        select: {
          suiAddress: true,
          username: true,
        },
      },
    },
  });

  res.json({
    address: profile.user.suiAddress,
    username: profile.user.username,
    totalPnl: Number(profile.totalPnl),
    winRate: Number(profile.winRate) * 100,
    totalTrades: profile.totalTrades,
    totalFollowers: profile.totalFollowers,
    isVerified: profile.isVerified,
    tier: profile.tier,
    recentTrades,
    followers,
  });
});
```

**å¯¦ç¾æª”æ¡ˆé ç•Œé¢**ï¼š

```typescript
// frontend/src/pages/Profile.tsx
import { useParams } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';
import { PerformanceChart } from '@/components/leaderboard/PerformanceChart';

export function Profile() {
  const { address } = useParams();

  const { data: stats } = useQuery({
    queryKey: ['trader-stats', address],
    queryFn: () => api.getTraderStats(address!),
  });

  if (!stats) return <div>Loading...</div>;

  return (
    <div className="profile-page">
      <div className="profile-header">
        <h1>{stats.username || `Trader ${address?.slice(0, 8)}`}</h1>
        {stats.isVerified && <span className="badge-verified">é©—è­‰äº¤æ˜“è€…</span>}
        {stats.tier > 0 && <span className="tier-badge">{getTierName(stats.tier)}</span>}
      </div>

      <div className="stats-grid">
        <div className="stat-card">
          <label>ç¸½ç›ˆè™§</label>
          <span className={stats.totalPnl > 0 ? 'profit' : 'loss'}>
            ${stats.totalPnl.toFixed(2)}
          </span>
        </div>

        <div className="stat-card">
          <label>å‹ç‡</label>
          <span>{stats.winRate.toFixed(1)}%</span>
        </div>

        <div className="stat-card">
          <label>ç¸½äº¤æ˜“</label>
          <span>{stats.totalTrades}</span>
        </div>

        <div className="stat-card">
          <label>è·Ÿéš¨è€…</label>
          <span>{stats.totalFollowers}</span>
        </div>
      </div>

      <PerformanceChart trades={stats.recentTrades} />

      <div className="recent-trades">
        <h2>æœ€è¿‘äº¤æ˜“</h2>
        <table>
          {/* äº¤æ˜“åˆ—è¡¨ */}
        </table>
      </div>

      <div className="followers-list">
        <h2>è·Ÿéš¨è€…</h2>
        {/* Followers åˆ—è¡¨ */}
      </div>
    </div>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] æª”æ¡ˆé é¡¯ç¤ºå®Œæ•´ä¿¡æ¯
- [ ] ç¸¾æ•ˆåœ–è¡¨æ¸²æŸ“æ­£ç¢º
- [ ] äº¤æ˜“æ­·å²é¡¯ç¤º

---

### Day 6 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 6.2: é€šçŸ¥ç³»çµ± â±ï¸ 2h

**å¯¦ç¾é€šçŸ¥æœå‹™**ï¼š

```typescript
// backend/src/services/notification/sender.ts
import { Novu } from '@novu/node';

const novu = new Novu(process.env.NOVU_API_KEY!);

export class NotificationService {
  async sendCopyTradeNotification(params: {
    followerAddress: string;
    type: 'SUCCESS' | 'FAILED' | 'SKIPPED';
    details: any;
  }) {
    await novu.trigger('copy-trade-notification', {
      to: {
        subscriberId: params.followerAddress,
      },
      payload: {
        type: params.type,
        ...params.details,
      },
    });
  }

  async sendRiskAlert(params: {
    userAddress: string;
    healthScore: number;
    riskRatio: number;
  }) {
    await novu.trigger('risk-alert', {
      to: {
        subscriberId: params.userAddress,
      },
      payload: {
        healthScore: params.healthScore,
        riskRatio: params.riskRatio,
        severity: params.healthScore < 30 ? 'CRITICAL' : 'WARNING',
      },
    });
  }
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] é€šçŸ¥å¯ä»¥ç™¼é€
- [ ] å‰ç«¯å¯ä»¥æ¥æ”¶é€šçŸ¥

---

#### ä»»å‹™ 6.3: æ•¸æ“šå¯è¦–åŒ– â±ï¸ 3h

**å¯¦ç¾ç¸¾æ•ˆåœ–è¡¨**ï¼š

```typescript
// frontend/src/components/leaderboard/PerformanceChart.tsx
import { Line } from 'recharts';
import { LineChart, XAxis, YAxis, Tooltip, CartesianGrid } from 'recharts';

export function PerformanceChart({ trades }) {
  const chartData = trades.reduce((acc, trade, index) => {
    const prevPnl = index > 0 ? acc[index - 1].cumulativePnl : 0;
    const cumulativePnl = prevPnl + Number(trade.pnl || 0);

    return [...acc, {
      date: new Date(trade.createdAt).toLocaleDateString(),
      cumulativePnl,
      pnl: Number(trade.pnl || 0),
    }];
  }, [] as any[]);

  return (
    <div className="performance-chart">
      <h3>ç¸¾æ•ˆèµ°å‹¢</h3>
      <LineChart width={800} height={400} data={chartData}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis dataKey="date" />
        <YAxis />
        <Tooltip />
        <Line
          type="monotone"
          dataKey="cumulativePnl"
          stroke="#8884d8"
          strokeWidth={2}
        />
      </LineChart>
    </div>
  );
}
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] åœ–è¡¨æ¸²æŸ“æ­£ç¢º
- [ ] æ•¸æ“šæ›´æ–°å¯¦æ™‚

---

### Day 6 ç¸½çµ & æª¢æŸ¥é»

**å®Œæˆæ¨™èªŒ**ï¼š
- âœ… æ’è¡Œæ¦œç³»çµ±å®Œæ•´
- âœ… äº¤æ˜“è€…æª”æ¡ˆé å®Œæˆ
- âœ… é€šçŸ¥ç³»çµ±å¯ç”¨
- âœ… æ•¸æ“šå¯è¦–åŒ–å®Œæˆ
- âœ… Git Tag: `v0.3-social-features`

---

## Day 7: å„ªåŒ–èˆ‡æ¼”ç¤º

### Day 7 ä¸Šåˆ (9:00 - 12:00)

#### ä»»å‹™ 7.1: Bug ä¿®å¾©èˆ‡å„ªåŒ– â±ï¸ 3h

**å„ªå…ˆç´šåˆ—è¡¨**ï¼š
1. âœ… ä¿®å¾©æ‰€æœ‰é˜»å¡æ€§ Bug
2. âœ… å„ªåŒ–åŠ è¼‰é€Ÿåº¦
3. âœ… å®Œå–„éŒ¯èª¤è™•ç†
4. âœ… UI/UX èª¿æ•´

**æª¢æŸ¥æ¸…å–®**ï¼š
```
â–¡ éŒ¢åŒ…é€£æ¥ç©©å®š
â–¡ äº¤æ˜“åŸ·è¡ŒæˆåŠŸç‡ > 95%
â–¡ è·Ÿå–®å»¶é² < 5 ç§’
â–¡ é é¢åŠ è¼‰ < 3 ç§’
â–¡ ç§»å‹•ç«¯é©é…åŸºæœ¬å¯ç”¨
â–¡ æ‰€æœ‰è¡¨å–®é©—è­‰å·¥ä½œ
â–¡ éŒ¯èª¤æ¶ˆæ¯å‹å¥½
â–¡ Loading ç‹€æ…‹å®Œæ•´
```

---

### Day 7 ä¸‹åˆ (13:00 - 18:00)

#### ä»»å‹™ 7.2: Demo å½±ç‰‡éŒ„è£½ â±ï¸ 2h

**å½±ç‰‡è…³æœ¬**ï¼ˆ3-5 åˆ†é˜ï¼‰ï¼š

**ç¬¬ 1 éƒ¨åˆ†ï¼šå•é¡Œé™³è¿° (30s)**
- DeFi ä¿è­‰é‡‘äº¤æ˜“é–€æª»é«˜
- æ–°æ‰‹å®¹æ˜“çˆ†å€‰
- ç¼ºä¹å­¸ç¿’é€”å¾‘

**ç¬¬ 2 éƒ¨åˆ†ï¼šè§£æ±ºæ–¹æ¡ˆ (60s)**
- MarginMaster ä»‹ç´¹
- æ ¸å¿ƒåŠŸèƒ½å±•ç¤º
  - ç¤¾äº¤è·Ÿå–®
  - AI é¢¨éšªç®¡ç†
  - é€æ˜æ’è¡Œæ¦œ

**ç¬¬ 3 éƒ¨åˆ†ï¼šå¯¦éš›æ¼”ç¤º (120s)**
1. é€£æ¥éŒ¢åŒ…
2. ç€è¦½æ’è¡Œæ¦œ
3. æŸ¥çœ‹äº¤æ˜“è€…æª”æ¡ˆ
4. å‰µå»ºè·Ÿå–®é—œä¿‚
5. Leader åŸ·è¡Œäº¤æ˜“
6. Follower è‡ªå‹•è·Ÿå–®ï¼ˆå±•ç¤ºé€šçŸ¥ï¼‰
7. é¢¨éšªå„€è¡¨æ¿æ›´æ–°

**ç¬¬ 4 éƒ¨åˆ†ï¼šæŠ€è¡“äº®é» (30s)**
- Sui ä½ gas è²»
- äºç§’ç´šç¢ºèª
- å®Œå…¨é€æ˜
- æ™ºèƒ½é¢¨éšªç®¡ç†

**ç¬¬ 5 éƒ¨åˆ†ï¼šæœªä¾†è¦åŠƒ (30s)**
- ç­–ç•¥å¸‚å ´
- ç§»å‹• App
- AI äº¤æ˜“åŠ©æ‰‹

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] å½±ç‰‡éŒ„è£½å®Œæˆ
- [ ] ç•«è³ªæ¸…æ™°
- [ ] éŸ³é »æ¸…æ¥š
- [ ] æ™‚é•· 3-5 åˆ†é˜

---

#### ä»»å‹™ 7.3: Pitch Deck æº–å‚™ â±ï¸ 2h

**å¹»ç‡ˆç‰‡çµæ§‹**ï¼ˆ10-12 é ï¼‰ï¼š

1. **å°é¢** - MarginMaster Logo + Tagline
2. **å•é¡Œ** - DeFi ä¿è­‰é‡‘äº¤æ˜“çš„ 3 å¤§ç—›é»
3. **è§£æ±ºæ–¹æ¡ˆ** - ç¤¾äº¤è·Ÿå–® + AI é¢¨éšªç®¡ç†
4. **ç”¢å“æ¼”ç¤º** - æ ¸å¿ƒåŠŸèƒ½æˆªåœ–
5. **å¸‚å ´æ©Ÿæœƒ** - TAM/SAM/SOM
6. **ç«¶çˆ­å„ªå‹¢** - vs eToro, vs dYdX
7. **æŠ€è¡“æ¶æ§‹** - æ¶æ§‹åœ–
8. **å•†æ¥­æ¨¡å¼** - æ”¶å…¥ä¾†æº
9. **Traction** - Demo æ•¸æ“šï¼ˆæ¨¡æ“¬ï¼‰
10. **è·¯ç·šåœ–** - Phase 1/2/3
11. **åœ˜éšŠ** - åœ˜éšŠä»‹ç´¹
12. **Call to Action** - è¯ç¹«æ–¹å¼

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] Pitch Deck å®Œæˆ
- [ ] è¨­è¨ˆçµ±ä¸€
- [ ] é‚è¼¯æ¸…æ™°

---

#### ä»»å‹™ 7.4: æœ€çµ‚éƒ¨ç½² â±ï¸ 1h

```bash
# Frontend éƒ¨ç½²åˆ° Vercel
cd frontend
vercel --prod

# Backend éƒ¨ç½²åˆ° Railway
cd backend
railway up

# æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒ
curl https://api.marginmaster.app/health
curl https://marginmaster.app
```

**æª¢æŸ¥é» âœ“**ï¼š
- [ ] å‰ç«¯éƒ¨ç½²æˆåŠŸ
- [ ] å¾Œç«¯éƒ¨ç½²æˆåŠŸ
- [ ] æ•¸æ“šåº«é€£æ¥æ­£å¸¸
- [ ] æ‰€æœ‰åŠŸèƒ½å¯ç”¨

---

## æ¸¬è©¦ç­–ç•¥

### å–®å…ƒæ¸¬è©¦

**æ™ºèƒ½åˆç´„æ¸¬è©¦**ï¼š
```bash
sui move test
```

**å‰ç«¯æ¸¬è©¦**ï¼š
```bash
npm run test
```

**å¾Œç«¯æ¸¬è©¦**ï¼š
```bash
npm run test
```

### é›†æˆæ¸¬è©¦

**ç«¯åˆ°ç«¯æµç¨‹**ï¼š
1. ç”¨æˆ¶è¨»å†Š â†’ å‰µå»º Trader Profile
2. å‰µå»ºè·Ÿå–®é—œä¿‚
3. Leader åŸ·è¡Œäº¤æ˜“
4. Follower è‡ªå‹•è·Ÿå–®
5. æ’è¡Œæ¦œæ›´æ–°

### å£“åŠ›æ¸¬è©¦ï¼ˆå¯é¸ï¼‰

- 100 å€‹ä¸¦ç™¼è·Ÿå–®è«‹æ±‚
- 1000 æ¢äº¤æ˜“è¨˜éŒ„æŸ¥è©¢
- æ’è¡Œæ¦œå¿«å–å‘½ä¸­ç‡

---

## éƒ¨ç½²æ–¹æ¡ˆ

### ç’°å¢ƒæº–å‚™

**é–‹ç™¼ç’°å¢ƒ**ï¼š
- Sui Devnet
- æœ¬åœ° PostgreSQL
- æœ¬åœ° Redis

**æ¸¬è©¦ç’°å¢ƒ**ï¼š
- Sui Testnet
- Supabase
- Upstash Redis

**ç”Ÿç”¢ç’°å¢ƒ**ï¼ˆPhase 2ï¼‰ï¼š
- Sui Mainnet
- Supabase Pro
- Upstash Redis Pro

### éƒ¨ç½²æª¢æŸ¥æ¸…å–®

```
â–¡ ç’°å¢ƒè®Šæ•¸é…ç½®å®Œæˆ
â–¡ æ•¸æ“šåº«é·ç§»åŸ·è¡Œ
â–¡ æ™ºèƒ½åˆç´„éƒ¨ç½²åˆ° Testnet
â–¡ å‰ç«¯éƒ¨ç½²åˆ° Vercel
â–¡ å¾Œç«¯éƒ¨ç½²åˆ° Railway
â–¡ DNS é…ç½®å®Œæˆ
â–¡ HTTPS è­‰æ›¸é…ç½®
â–¡ ç›£æ§é…ç½®ï¼ˆSentryï¼‰
â–¡ åˆ†æé…ç½®ï¼ˆMixpanelï¼‰
```

---

## é¢¨éšªç®¡ç†

### æŠ€è¡“é¢¨éšª

| é¢¨éšª | å¯èƒ½æ€§ | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|--------|------|---------|
| DeepBook API è®Šæ›´ | ä½ | é«˜ | ä½¿ç”¨å®˜æ–¹ SDKï¼Œå®šæœŸæª¢æŸ¥æ›´æ–° |
| æ™ºèƒ½åˆç´„ Bug | ä¸­ | é«˜ | å……åˆ†æ¸¬è©¦ï¼Œä»£ç¢¼å¯©è¨ˆ |
| Gas è²»ç”¨éé«˜ | ä½ | ä¸­ | Sui gas è²»æœ¬èº«å¾ˆä½ |
| æ€§èƒ½ç“¶é ¸ | ä¸­ | ä¸­ | å¿«å–ç­–ç•¥ï¼Œæ•¸æ“šåº«ç´¢å¼• |

### æ™‚é–“é¢¨éšª

| é¢¨éšª | ç·©è§£æªæ–½ |
|------|---------|
| åŠŸèƒ½é–‹ç™¼è¶…æ™‚ | ç æ‰éæ ¸å¿ƒåŠŸèƒ½ï¼ˆæ¨¡æ“¬æ¨¡å¼ã€é€šçŸ¥ï¼‰ |
| Bug ä¿®å¾©è€—æ™‚ | é ç•™ Day 7 æ•´å¤©è™•ç† |
| éƒ¨ç½²å•é¡Œ | æå‰æ¸¬è©¦éƒ¨ç½²æµç¨‹ |

### æ‡‰æ€¥è¨ˆåŠƒ

**å¦‚æœé€²åº¦è½å¾Œ**ï¼š
- Day 3ï¼šç æ‰æ¨¡æ“¬äº¤æ˜“æ¨¡å¼
- Day 5ï¼šä½¿ç”¨å‡æ•¸æ“šå¡«å……æ’è¡Œæ¦œ
- Day 6ï¼šç°¡åŒ–é€šçŸ¥ç³»çµ±
- Day 7ï¼šä½¿ç”¨ç¾æˆ UI æ¨¡æ¿

---

## ç¸½çµ

### 7 å¤©æˆæœ

âœ… **å®Œæ•´çš„ MVP ç”¢å“**ï¼š
- ä¿è­‰é‡‘äº¤æ˜“ç•Œé¢
- ä¸€éµè·Ÿå–®ç³»çµ±
- äº¤æ˜“è€…æ’è¡Œæ¦œ
- é¢¨éšªç›£æ§ç³»çµ±

âœ… **å¯æ¼”ç¤ºçš„ Demo**ï¼š
- 3-5 åˆ†é˜å½±ç‰‡
- Pitch Deck
- ç·šä¸Šå¯è¨ªå•

âœ… **æŠ€è¡“ç©ç´¯**ï¼š
- Sui Move æ™ºèƒ½åˆç´„
- React + Node.js å…¨æ£§
- DeepBook é›†æˆç¶“é©—

### å¾ŒçºŒå·¥ä½œ

**Week 2-4**ï¼š
- ç­–ç•¥å¸‚å ´é–‹ç™¼
- ç§»å‹• App
- å®‰å…¨å¯©è¨ˆ

**Month 2-3**ï¼š
- ä¸»ç¶²éƒ¨ç½²
- å¸‚å ´æ¨å»£
- ç”¨æˆ¶å¢é•·

---

**ä¸‹ä¸€æ­¥é–±è®€**ï¼š
- [æ•¸æ“šåº«èˆ‡ API è¨­è¨ˆ](./MarginMaster_Database_API.md)
- [å¾Œç«¯æ¶æ§‹](./MarginMaster_Backend.md)
- [AGI é–‹ç™¼æŒ‡å—](./MarginMaster_AGI_Guide.md)
